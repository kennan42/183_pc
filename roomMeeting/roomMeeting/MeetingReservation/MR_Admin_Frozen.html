<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>会议室冻结</title>
    <meta name="description" content="Common Buttons &amp; Icons" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../assets/css/bootstrap-timepicker.css" />
    <!-- page specific plugin styles -->
    <!-- text fonts -->
    <link rel="stylesheet" href="../assets/css/ace-fonts.css" />
    <!-- ace styles -->
    <link rel="stylesheet" href="../assets/css/ace.min.css" />
    <!--[if lte IE 9]>
        <link rel="stylesheet" href="../assets/css/ace-part2.min.css" />
    <![endif]-->
    <link rel="stylesheet" href="../assets/css/ace-skins.min.css" />
    <link rel="stylesheet" href="../assets/css/ace-rtl.min.css" />
    <!--[if lte IE 9]>
      <link rel="stylesheet" href="../assets/css/ace-ie.min.css" />
    <![endif]-->
    <!-- inline styles related to this page -->
    <!-- ace settings handler -->
    <script src="../assets/js/ace-extra.min.js"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lte IE 8]>
    <script src="../assets/js/html5shiv.js"></script>
    <script src="../assets/js/respond.min.js"></script>
    <![endif]-->
    <script src='../assets/js/jquery.min.js'></script>
    <script src="../layer/layer.min.js"></script>

    <script src="../myjs/backupNew.js"></script>
    <script src="../myjs/lexus.js"></script>
    
    <!-- ace settings handler -->
    <script src="../assets/js/ace-extra.min.js"></script>
    <script src="../assets/js/bootstrap-tag.min.js"></script>
    <script src='../assets/js/jquery.min.js'></script>
    <script src="../layer/layer.min.js"></script>
    <script src="../myjs/gys.js"></script>
    <script src="../myjs/lexus.js"></script>

    <!-- 加载自定义样式 -->
    <link rel="stylesheet" href="css/custom.css">
    <style type="text/css">
        .tooltip-info+.tooltip.bottom .tooltip-arrow, .tooltip.tooltip-info.bottom .tooltip-arrow{
            border-bottom-color:#428bca;
        }
        .tooltip-info+.tooltip>.tooltip-inner, .tooltip.tooltip-info>.tooltip-inner{
            background-color:#428bca;
            border-radius: 4px;
        }
        .hr-solid{
            height:1px;
            border-top:1px solid #d5e3ef;
            border-bottom:none;
        }
        .text-onclick{
            color: #ed7735;
        }
        .control-label {
            color: #667E99;
        }
        input[type="text"], input[type="password"], input[type="datetime"], input[type="datetime-local"], input[type="date"], input[type="month"], input[type="time"], input[type="week"], input[type="number"], input[type="email"], input[type="url"], input[type="search"], input[type="tel"], input[type="color"] 
        {
            border-radius: 0 !important;
            color: #858585;
            background-color: #fff;
            border: 1px solid #8aafce;
            padding: 5px 4px 6px;
            font-size: 14px;
            font-family: inherit;
            -webkit-box-shadow: none !important;
            box-shadow: none !important;
            -webkit-transition-duration: .1s;
            transition-duration: .1s;
        }
        .form-control, select {
            border-radius: 0;
            -webkit-box-shadow: none !important;
            box-shadow: none !important;
            color: #858585;
            background-color: #fff;
            border: 1px solid #8aafce;
        }
    </style>
</head>
    <body class="no-skin">
        <!-- /section:basics/navbar.layout -->
        <!-- /section:basics/navbar.layout -->
        <div class="main-container" id="main-container">
            <script type="text/javascript">
                try { ace.settings.check('main-container', 'fixed') } catch (e) { }
            </script>
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch(e) {}
                </script>
                <ul class="breadcrumb">
                    <li>
                        <i class="ace-icon fa fa-home home-icon">
                        </i>
                        <a href="#">
                            会议室冻结
                        </a>
                    </li>
                </ul>
                <!-- /.breadcrumb -->
                <button class="btn border-none" style="float:right;" onClick="closeLay()">
                    <i class="glyphicon glyphicon-remove align-top">
                    </i>
                </button>
            </div>
            <!-- /section:basics/content.breadcrumbs -->
            <div class="page-content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="col-sm-12">
                            <div class="tab-content">
                                <form class="form-horizontal" role="form">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="form-field-sername"> 开始时间 </label>
                                        <div class="col-sm-10">
                                             <div class="col-sm-12" style="padding:0px;">
                                                <div class="col-sm-5 igbt_01" style="padding-left: 0px;">
                                                    <div class="input-group">
                                                        <input class="form-control date-picker" id="id-date-picker-1" type="text" data-date-format="yyyy-mm-dd" name="startTime"/>
                                                        <span class="input-group-addon">
                                                            <i class="fa fa-calendar bigger-110 orange"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="col-sm-5 igbt_02 timebt">
                                                    <div class="input-group bootstrap-timepicker">
                                                        <input id="timepicker1" type="text" class="form-control" name="startTime1"/>
                                                        <span class="input-group-addon">
                                                            <i class="fa fa-clock-o bigger-110 orange"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="form-field-sername"> 结束时间 </label>
                                        <div class="col-sm-10">
                                            <div class="col-sm-5 igbt_01" style="padding-left: 0px;">
                                                <div class="input-group">
                                                    <input class="form-control date-picker" id="id-date-picker-1" type="text" data-date-format="yyyy-mm-dd" name="endTime"/>
                                                    <span class="input-group-addon">
                                                        <i class="fa fa-calendar bigger-110 orange"></i>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-sm-5 igbt_02 timebt">
                                                <div class="input-group bootstrap-timepicker">
                                                    <input id="timepicker2" type="text" class="form-control" name="endTime1"/>
                                                    <span class="input-group-addon">
                                                        <i class="fa fa-clock-o bigger-110 orange"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                     <div class="hr hr-solid hr18" id="gysBackiftz-0-line"></div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="form-field-sername"> 冻结理由 </label>
                                        <div class="col-sm-9">
                                             <textarea class="form-control limited" placeholder="输入冻结理由" id="dongjieliyou" style="resize:none;height: 80px;"></textarea>
                                        </div>
                                    </div>

                                    <div class="clearfix form-actions" style="background-color:#fff;border-top:1px solid #d5e3ef;">
                                        <div class="col-sm-12" >
                                            <div class="col-sm-6">
                                                <button class="btn btn-warning" style="width:50%;float: right;" type="button" onClick="closeLay()">
                                                    <i class="ace-icon fa fa-undo bigger-110"></i>
                                                    取消
                                                </button>
                                            </div>
                                            <div class="col-sm-6">
                                                <button class="btn btn-info" style="width:50%;" type="button" onclick="frozenRoom()">
                                                    <i class="ace-icon fa fa-check bigger-110"></i>
                                                    提交
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.page-content -->
        </div><!-- /.main-container -->
        <!-- basic scripts -->
        <!--[if !IE]> -->
        <script type="text/javascript">
            window.jQuery || document.write("<script src='../assets/js/jquery.min.js'>" + "<" + "/script>");
        </script>

        <!-- <![endif]-->
        <!--[if IE]>
        <script type="text/javascript">
         window.jQuery || document.write("<script src='../assets/js/jquery1x.min.js'>"+"<"+"/script>");
        </script>
        <![endif]-->
        <script type="text/javascript">
            if ('ontouchstart' in document.documentElement) document.write("<script src='../assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
        </script>
        <script src="../assets/js/bootstrap.min.js"></script>

        <!-- page specific plugin scripts -->
        <!--[if lte IE 8]>
          <script src="../assets/js/excanvas.min.js"></script>
        <![endif]-->
        <script src="../assets/js/jquery-ui.custom.min.js"></script>
        <script src="../assets/js/jquery.ui.touch-punch.min.js"></script>
        <script src="../assets/js/chosen.jquery.min.js"></script>
        <script src="../assets/js/fuelux/fuelux.spinner.min.js"></script>
        <script src="../assets/js/date-time/bootstrap-datepicker.min.js"></script>
        <script src="../assets/js/date-time/bootstrap-timepicker.min.js"></script>
        <script src="../assets/js/date-time/moment.min.js"></script>
        <script src="../assets/js/date-time/daterangepicker.min.js"></script>
        <script src="../assets/js/date-time/bootstrap-datetimepicker.min.js"></script>
        <script src="../assets/js/bootstrap-colorpicker.min.js"></script>
        <script src="../assets/js/jquery.knob.min.js"></script>
        <script src="../assets/js/jquery.autosize.min.js"></script>
        <script src="../assets/js/jquery.inputlimiter.1.3.1.min.js"></script>
        <script src="../assets/js/jquery.maskedinput.min.js"></script>
        <script src="../assets/js/bootstrap-tag.min.js"></script>
        <!--<script src="../assets/js/typeahead.jquery.min.js"></script>--><!-- 缺少 -->
        <script src="../assets/js/dropzone.min.js"></script>
        <!-- ace scripts -->
        <script src="../assets/js/ace-elements.min.js"></script>
        <script src="../assets/js/ace.min.js"></script>

        <script src="../assets/js/bootbox.min.js"></script>
        <script src="../assets/js/jquery.easypiechart.min.js"></script>
        <script src="../assets/js/jquery.gritter.min.js"></script>

        <!-- inline scripts related to this page -->
         <script type="text/javascript">
            var updateUser=new Array();
            jQuery(function ($) {
                $.ajaxSetup({
                    contentType: 'application/json',
                    async:false,
                    error:function(){
                        var unique_id = $.gritter.add({
                            title: '系统警告信息提示',
                            text: ''+errMsg1+'<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
                            sticky: true,
                            time: '',
                            class_name: 'gritter-info gritter-center'
                        });
                    },
                    timeout:timeout
                 });

                //时间
                $('#timepicker1').timepicker({
                    minuteStep: 1,
                    showSeconds: false,
                    showMeridian: false
                })
                .next().on(ace.click_event, function(){
                    $(this).prev().focus();
                });

                $('#timepicker2').timepicker({
                    minuteStep: 1,
                    showSeconds: false,
                    showMeridian: false
                })
                .next().on(ace.click_event, function(){
                    $(this).prev().focus();
                });

                //日期
                $('.date-picker').datepicker({
                    autoclose: true,
                    todayHighlight: true
                })
                .next().on(ace.click_event, function(){
                    $(this).prev().focus();
                });

                //72000 28800

                $('#timepicker1').timepicker().on('hide.timepicker', function(e) {
//                  var startTime1=$("input[name=startTime1]").val();
//                  startTime1=changexiaoshi(startTime1);
//                  if(startTime1 < 28800  || startTime1 > 72000){
//                        $("input[name=startTime1]").val('08:00');
//                  }
                });
                $('#timepicker2').timepicker().on('hide.timepicker', function(e) {
//                  var endTime1=$("input[name=endTime1]").val();
//                 // alert(endTime1);
//                  endTime1=changexiaoshi(endTime1);
//                  if(endTime1 < 28800  || endTime1 > 72000){
//                        $("input[name=endTime1]").val('20:00');
//                  }
                });

                selectUser();
            });
            //关闭弹出层
            function closeLay() {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            }

            // 获取请求链接中的指定参数的值
            function getQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null)
                    return r[2];
                return null;
            }

            //冻结会议室
            function frozenRoom(){
                var startTime=$("input[name=startTime]").val();
                var startTime1=$("input[name=startTime1]").val();
                

                startTime=startTime+' '+startTime1;
                if(startTime ==''){
                    layer.msg("请选择开始日期", 1, -1);
                    return false;
                }
                if(startTime1 ==''){
                    layer.msg("请选择开始时间", 1, -1);
                    return false;
                }
                startTime=changeTime(startTime);
                var endTime=$("input[name=endTime]").val();
                var endTime1=$("input[name=endTime1]").val();
                if(endTime ==''){
                    layer.msg("请选择结束日期", 1, -1);
                    return false;
                }
                if(endTime1 ==''){
                    layer.msg("请选择结束时间", 1, -1);
                    return false;
                }
                endTime=endTime+' '+endTime1;
                endTime=changeTime(endTime);
                var nawTime=(new Date()).valueOf();
                /*
                if(startTime < nawTime){
                    layer.msg("冻结开始时间不能小于当前时间", 1, -1);
                    return false;
                }*/
                if(startTime > endTime){
                    layer.msg("冻结结束时间不能小于冻结开始时间", 1, -1);
                    return false;
                }
                var endReason=$("#dongjieliyou").val();
                
                $.ajaxSetup({
                    contentType: 'application/json',
                    async:false,
                    error:function(){
                        var unique_id = $.gritter.add({
                            title: '系统警告信息提示',
                            text: ''+errMsg1+'<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
                            sticky: true,
                            time: '',
                            class_name: 'gritter-info gritter-center'
                        });
                    },
                    timeout:timeout
                 });
                 
                var paramJSon = {
                        "meetingRoomId":getQueryString("meetRoomId"),
                        "startTime":startTime,
                        "endTime":endTime,
                };
                
                $.post("/meet/getBookingMeetingRooms",JSON.stringify(paramJSon),function(data){
                    //console.log(data);
                    if(data.status == 0){
                        if (data.data.length > 0) {
                            layer.msg('您冻结时间内已有预定记录，请取消或驳回用户记录后再进行冻结操作。', 3, -1);
                        } else {
                            var paramJSon = {
                                    "roomId":getQueryString("meetRoomId"),
                                    "startTime":startTime,
                                    "endTime":endTime,
                                    "reason":endReason,
                                    "userId":localStorage["pernrBase"],
                                    "userName":updateUser['userName']
            
                                }
                            $.post("/meet/frozenRoom",JSON.stringify(paramJSon),function(data){
                                if(data.status == 0){
                                    var dongjie='<div class="profile-info-row dongjie">'
                                                            +'<div class="profile-info-name"> 冻结时间： </div>'
                                                            +'<div class="profile-info-value">'
                                                                +'<span class="editable" id="clearMinute">'+formatDate1(startTime)+'--'+formatDate1(endTime)+'</span>'
                                                            +'</div>'
                                                        +'</div>'
                                                        +'<div class="profile-info-row dongjie">'
                                                            +'<div class="profile-info-name"> 冻结理由： </div>'
                                                            +'<div class="profile-info-value">'
                                                                +'<span class="editable" id="clearMinute">'+endReason+'</span>'
                                                            +'</div>'
                                                        +'</div>';
                                    var index = parent.layer.getFrameIndex(window.name);
                                    parent.$("#frozenRoom").removeClass();
                                    parent.$("#frozenRoom").addClass('btn btn-success');
                                    var html1='<i class="ace-icon fa fa-unlock-alt"></i> 解冻';
                                    parent.$("#frozenRoom").html(html1);
                                    parent.$("#frozenRoom").attr("rel","1");
                                    parent.$("#stopRoom").removeClass();
                                    parent.$("#stopRoom").addClass('btn btn-grey');
                                    parent.$("#stopRoom").attr("rel","0");
                                    parent.$("#clearMinutess").after(dongjie);
                                    parent.layer.msg(data.msg, 3, -1);
                                    parent.location.reload();
                                    parent.layer.close(index);
                                }else{
                                    layer.msg(data.msg, 3, -1);
                                }
                            })
                        }
                    }else{
                        layer.msg(data.msg, 3, -1);
                    }
                });
            }

            function changexiaoshi(val){
                val=val.split(':');
                val1=Number(val[0]) * 3600;
                val2=Number(val[1])*60;
                return val1 + val2;
            }
            //时间戳格式化成正式时间可是
            function formatDate1(now){    
                var time = new Date(now);
                var ymdhis = "";
                ymdhis += time.getFullYear() + "-";
                ymdhis += Appendzero((time.getMonth()+1)) + "-";
                ymdhis += Appendzero(time.getDate());
                ymdhis += " " + Appendzero(time.getHours()) + ":";
                ymdhis += Appendzero(time.getMinutes());
                return ymdhis;
             }

             function Appendzero (obj) {
                if (obj < 10) return "0" + obj; else return obj;
            }

            function changeTime(string) {
                var f = string.split(' ', 2);
                var d = (f[0] ? f[0] : '').split('-', 3);
                var t = (f[1] ? f[1] : '').split(':', 3);
                return (new Date(
                        parseInt(d[0], 10) || null,
                        (parseInt(d[1], 10) || 1) - 1,
                        parseInt(d[2], 10) || null,
                        parseInt(t[0], 10) || null,
                        parseInt(t[1], 10) || null,
                        parseInt(t[2], 10) || null
                        )).getTime();
            }

            function selectUser(){
            var paramJSon = {
                "IS_PUBLIC":{
                            "FLOWNO":"",
                            "PERNR":"",
                            "ZDOMAIN":"400",
                            "I_PAGENO":"",
                            "I_PAGESIZE":""
                        },
                "P_DATE":"" ,
                "P_PERNR":{
                    "item":[{
                        "PERNR":localStorage["pernrBase"]
                    }]
                }
                           
              };
                $.post("/zhr/ZHR_GET_PER_EASY_INFO",JSON.stringify(paramJSon),function(data){
                data= typeof(data) == 'string'?$.parseJSON(data):data;
                if(data.RETURN_SUBRC == 0){
                    updateUser={'userId':localStorage["pernrBase"],'userName':data.EASY_TAB.item[0]['NACHN']}
                    
                }
            });
        }
        </script>

        <link rel="stylesheet" href="../assets/css/ace.onpage-help.css" />
        <link rel="stylesheet" href="../docs/assets/js/themes/sunburst.css" />

        <script type="text/javascript"> ace.vars['base'] = '..'; </script>
        <!--<script src="../assets/js/ace/elements.onpage-help.js"></script>--> <!-- 缺少 -->
        <script src="../assets/js/ace/ace.onpage-help.js"></script>
        <script src="../docs/assets/js/rainbow.js"></script>
        <script src="../docs/assets/js/language/generic.js"></script>
        <script src="../docs/assets/js/language/html.js"></script>
        <script src="../docs/assets/js/language/css.js"></script>
        <script src="../docs/assets/js/language/javascript.js"></script>
    </body>
</html>
