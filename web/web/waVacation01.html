<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>待审批</title>

		<meta name="description" content="Common UI Features &amp; Elements" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
     
        <!---css---->
        <link rel="stylesheet" type="text/css" href="./assets/css/new/newcss.css">
        
		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="./assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="./assets/css/font-awesome.min.css" />

		<!-- page specific plugin styles -->
		<link rel="stylesheet" href="./assets/css/jquery-ui.custom.min.css" />
		<link rel="stylesheet" href="./assets/css/jquery.gritter.css" />

		<!-- text fonts -->

		<!-- ace styles -->
		<link rel="stylesheet" href="./assets/css/ace.min.css" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="./assets/css/ace-part2.min.css" />
		<![endif]-->
        

		
       <script src='./assets/js/jquery.min.js'></script>
		<script src="./layer/layer.min.js"></script>
		<script src="./myjs/backupNew.js"></script>
		<script src="./myjs/lexus.js"></script>


		<script>
			function openDetail(k){
				var waVacationListsArr = JSON.parse(localStorage.getItem("waVacationListsArr"));
				var vaTimeShow = '';
					if(checkNoChar(waVacationListsArr[k].ALLDF) == 'X'){
								vaTimeShow = checkNoChar(waVacationListsArr[k].BEGDA)+' 至 '+checkNoChar(waVacationListsArr[k].ENDDA);
							}else{
								vaTimeShow = checkNoChar(waVacationListsArr[k].BEGDA)+' '+cutSecond(checkNoChar(waVacationListsArr[k].BEGUZ))+' 至 '+checkNoChar(waVacationListsArr[k].ENDDA)+' '+cutSecond(checkNoChar(waVacationListsArr[k].ENDUZ));
							}
					$('#sqr').html(checkNoChar(waVacationListsArr[k].reqUsrNm)+' '+parseInt(checkNoChar(waVacationListsArr[k].reqUsrId)));
					$('#xjlx').html(checkNoChar(waVacationListsArr[k].ATEXT));
					$('#xjsj').html(vaTimeShow);
					$('#xjts').html(checkNoChar(waVacationListsArr[k].ABWTG)+'天');
					$('#xjsy').html(checkNoChar(waVacationListsArr[k].REASON));
					//$('#jqlxdh').html(checkNoChar(waVacationListsArr[k].));
					var message = $(this).closest('.message-item');
					//if message is open, then close it
					if(message.hasClass('message-inline-open')) {
						message.removeClass('message-inline-open').find('.message-content').remove();
						return;
					}
			
					$('.message-container').append('<div class="message-loading-overlay"><i class="fa-spin ace-icon fa fa-spinner orange2 bigger-160"></i></div>');
					setTimeout(function() {
						$('.message-container').find('.message-loading-overlay').remove();
						message
							.addClass('message-inline-open')
							.append('<div class="message-content" />')
						var content = message.find('.message-content:last').html( $('#id-message-content').html() );
			
						//remove scrollbar elements
						content.find('.scroll-track').remove();
						content.find('.scroll-content').children().unwrap();
						
						content.find('.message-body').ace_scroll({
							size: 150,
							mouseWheelLock: true,
							styleClass: 'scroll-visible'
						});
				
					}, 500 + parseInt(Math.random() * 500));
			}
			
			
			//提交
			function submitVa(k,type,status,bussNo,taskId,currStep){
				var pernr1 = localStorage.pernrBase;
				if(undefined == pernr1 || null == pernr1 || '' == pernr1){
					layer.alert('用户信息获取异常，请重新登录',5);
					return;
				}
				var paramJSon = {
					"input":{
						"channelSerialNo":getDateNumber(),
						"currUsrId":parseInt(pernr1).toString(),
						"domain":"400",
						"extendMap":{
							"entry":[{
								"Key":"",
								"Value":""
							}]
						},
						"bussType":"2001",
						"bussNo":bussNo,
						"pubAppr":{
							"taskId":taskId,
							"appType":type,
							"appOpinion":trim($('#form-field-'+k).val()),
							"usrId":parseInt(pernr1).toString(),
							"currStep":currStep
						}
					}
			};
			var vaSubJSON = submit_8_6(paramJSon);
			if(vaSubJSON.status == '-1'){
				layer.alert('提交失败，请稍后重试',8);
			}else{
				layer.alert('提交成功',9,function(){
					window.location.href = '/web/waVacation.html';
				});
			}
			}
			
			//显示详情
			function showCon(conId){
				$('#content'+conId).toggle();
			}
			
			//翻页
			function changePage(flag){
				var pageNow = $('#pageNow').html();
				var pageAll = $('#pageAll').html();
				if(flag == '1'){
					if(pageNow == '1'){
						return;
					}
					//第一页
					changeDo('1');
				}
				
				if(flag == '2'){
					if(pageNow == '1'){
						return;
					}
					pageNow = parseInt(pageNow)-1;
					changeDo(pageNow);
				}
				
				if(flag == '3'){
					if(parseInt(pageNow) >= parseInt(pageAll)){
						return;
					}
					pageNow = parseInt(pageNow)+1;
					changeDo(pageNow);
				}
				
				if(flag == '4'){
					if(parseInt(pageNow) >= parseInt(pageAll)){
						return;
					}
					
					changeDo(pageAll);
				}
			}
			
			//翻页操作
			function changeDo(pageNo){
				//1获取休假待办列表和条数
				var waVacationListsJSON = submit_8_4(localStorage.pernrBase?localStorage.pernrBase:'',pageNo,10);
				if(waVacationListsJSON.status == '0'){
					var vacationCount = waVacationListsJSON.output.totalCount;
					//$('#xiujiaCount').html(vacationCount);
					
					//var pageAll = parseInt(vacationCount)%10 == 0?parseInt(vacationCount)/10:(parseInt(vacationCount/10)+1);
					//$('#pageAll').html(pageAll);
					
					$('#pageNow').html(pageNo);
					
					//待办休假列表数据
					var waVacationListsArr = [];
					if (waVacationListsJSON.output.waitTaskList.length == undefined) {  //只有一条数据的时候是对象，多条是数组
					
						waVacationListsArr.push(waVacationListsJSON.output.waitTaskList);
					}else{
						waVacationListsArr = waVacationListsJSON.output.waitTaskList;
					}
						var temp_bussNo = '';
						var temp_detail;
						var temp_per_detail;
						var temp_per;
						var temp_way;
						var temp_waysList;
						for(var k in waVacationListsArr){
							temp_bussNo = waVacationListsArr[k].bussNo;
							temp_per = waVacationListsArr[k].reqUsrId
							//获取休假详情
							temp_detail = submit_8_5(temp_bussNo);
							temp_per_detail = submit_5_3(temp_per);
							temp_way = submit_8_8(localStorage.pernrBase?localStorage.pernrBase:'',temp_bussNo);
							temp_waysList = temp_way.output.procApprInfoList.length == undefined?[].push(temp_way.output.procApprInfoList):temp_way.output.procApprInfoList;
							if(temp_detail.status == '0'){
								$.extend(waVacationListsArr[k],temp_detail.WF_P2001.item[0]);
								$.extend(waVacationListsArr[k],{attLists:temp_detail.FORM_TAB});
								$.extend(waVacationListsArr[k],temp_per_detail.EASY_TAB.item[0]);
								$.extend(waVacationListsArr[k],{wayList:temp_waysList});
							}
						}
						
						localStorage.removeItem("waVacationListsArr");
						localStorage.setItem("waVacationListsArr",JSON.stringify(waVacationListsArr));
						
						//构建列表
						
						var vaListStr = '<div class="message-item message-unread" style="background-color:#EFF7F7">'
						+'<table width="100%"><tbody><tr><td class="text-left" width="10%"> <label class="inline middle">'
						+'<input type="checkbox" id="id-toggle-all" class="ace"><span class="lbl"></span></label>全选</td>'
						+'<td class="text-left" width="10%"> 申请人</td><td class="text-left" width="10%">休假类型</td>'
						+'<td class="text-left" width="27%">休假时间</td><td class="text-left" width="30%">休假事由</td>'
						+'<td class="text-right">提交日期</td></tr>'
						+'</tbody></table></div>';
						var vaTimeShow = '';
						for(var k in waVacationListsArr){
								var fjListStr = '';
							var fjArr = [];
							var fjArr1 = [];
							if(checkNoChar(waVacationListsArr[k].ALLDF) == 'X'){
								vaTimeShow = checkNoChar(waVacationListsArr[k].BEGDA)+' 至 '+checkNoChar(waVacationListsArr[k].ENDDA);
							}else{
								vaTimeShow = checkNoChar(waVacationListsArr[k].BEGDA)+' '+cutSecond(checkNoChar(waVacationListsArr[k].BEGUZ))+' 至 '+checkNoChar(waVacationListsArr[k].ENDDA)+' '+cutSecond(checkNoChar(waVacationListsArr[k].ENDUZ));
							}
							if(undefined == waVacationListsArr[k].attLists || undefined == waVacationListsArr[k].attLists.item){
								
							}else{
								if(waVacationListsArr[k].attLists.item.length == undefined){
									fjArr.push(waVacationListsArr[k].attLists.item);
								}else{
									fjArr = waVacationListsArr[k].attLists.item;
								}
								for(var fj in fjArr){
									fjListStr += '<a href="http://'+localHostIp+'/zhr/ZHR_DOWNLOAD_DOCUMENT?DOC_ID='+checkNoChar(fjArr[fj].DOC_ID)+'">'
									+(checkNoChar(fjArr[fj].DOU_NAME) == ''?'未命名':checkNoChar(fjArr[fj].DOU_NAME))
									+'</a><br/>';
								}
							}
							
							vaListStr += '<div class="message-item message-unread">'
							+'<table width="100%">'
							+'<tbody>'
							+'<tr onclick="showCon(\''+k+'\')" style="cursor:pointer;">'
							+'<td class="text-left" width="10%">'
							+'<label class="inline middle">'
							+'<input type="checkbox"  class="ace" name="checkbox" value="'+k+',AG,'+checkNoChar(waVacationListsArr[k].status)+','+checkNoChar(waVacationListsArr[k].bussNo)+','+checkNoChar(waVacationListsArr[k].taskId)+','+checkNoChar(waVacationListsArr[k].currStep)+'"/>'
							+'<span class="lbl"></span>'
							+'</label>'
							+'</td>'
							+'<td class="text-left"  width="10%"> '+checkNoChar(waVacationListsArr[k].reqUsrNm)+'</td>'
							+'<td class="text-left"  width="10%">'+checkNoChar(waVacationListsArr[k].ATEXT)+'</td>'
							+'<td class="text-left"  width="27%">'+vaTimeShow+'</td>'
							+'<td class="text-left"  width="30%">'+checkNoChar(waVacationListsArr[k].REASON)+'</td>'
							+'<td class="text-right">'+checkNoChar(waVacationListsArr[k].crtDate)+'</td>'
							+'</tr>'
							+'</tbody>'
							+'</table>'
							//下面是详情部分
							
							
							
							+'<div class="message-content" id="content'+k+'" style="display:none">'
							+'<div style="border-color: rgb(241, 241, 241);" class="widget-box widget-color-orange collapsed">'
							+'<div style="background-color: rgb(241, 241, 241);" class="widget-header widget-header-small collapsed">'
							+'<span class="blue bigger-125 widget-title"> 基本信息 </span>'
							+'</div>'
							+'<div><div class="widget-main"><div class="message-header">'
							+'<table class="table  text-center"><tbody>'
							+'<tr><td class="text-right grey">申请人</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].reqUsrNm)+' '+parseInt(checkNoChar(waVacationListsArr[k].reqUsrId))+'</td></tr>'
							+'<tr><td class="text-right grey">公司</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].BUTXT)+'</td></tr>'
							+'<tr><td class="text-right grey">部门</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].BUMEN)+'</td></tr>'
							+'<tr><td class="text-right grey">岗位</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].PLSTX)+'</td></tr>'
							+'<tr><td class="text-right grey">休假类型</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].ATEXT)+'</td></tr>'
							+'<tr><td class="text-right grey">休假时间</td>'
							+'<td class="text-left">'+vaTimeShow+'</td></tr>'
							+'<tr><td class="text-right grey">休假天数</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].ABWTG)+'天</td></tr>'
							+'<tr><td class="text-right grey">休假事由</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].REASON)+'</td></tr>'
							+'<tr><td class="text-right grey">假期联系电话</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].COMM)+'</td></tr>'
							+'<tr><td class="text-right grey">附件下载</td>'
							+'<td class="text-left">'+fjListStr+'</td></tr>'
							+'</tbody></table>'
							+'</div></div></div></div>'
							
							
							
							+'<div class="message-header"><div class="row">'
							+'<div class="col-md-7 col-md-push-0"><input id="form-field-'+k+'" class="col-md-12" type="text" placeholder="同意"></div>'
							+'<div class="col-md-5 col-md-pull-0 text-right">'
							+'<span id="bhBtn" class="btn btn-info btn-sm tooltip-info" title="" onclick="submitVa(\''+k+'\',\'RT\',\''+checkNoChar(waVacationListsArr[k].status)+'\',\''+checkNoChar(waVacationListsArr[k].bussNo)+'\',\''+checkNoChar(waVacationListsArr[k].taskId)+'\',\''+checkNoChar(waVacationListsArr[k].currStep)+'\')" data-placement="bottom" data-rel="tooltip" style="margin-right:3px">驳回</span>'
							+'<span id="bhBtn" class="btn btn-info btn-sm tooltip-info" title="" onclick="submitVa(\''+k+'\',\'RF\',\''+checkNoChar(waVacationListsArr[k].status)+'\',\''+checkNoChar(waVacationListsArr[k].bussNo)+'\',\''+checkNoChar(waVacationListsArr[k].taskId)+'\',\''+checkNoChar(waVacationListsArr[k].currStep)+'\')" data-placement="bottom" data-rel="tooltip" style="margin-right:3px">拒绝</span>'
							+'<span id="bhBtn" class="btn btn-info btn-sm tooltip-info" title="" onclick="submitVa(\''+k+'\',\'AG\',\''+checkNoChar(waVacationListsArr[k].status)+'\',\''+checkNoChar(waVacationListsArr[k].bussNo)+'\',\''+checkNoChar(waVacationListsArr[k].taskId)+'\',\''+checkNoChar(waVacationListsArr[k].currStep)+'\')" data-placement="bottom" data-rel="tooltip">同意</span>'
							+'</div></div></div>'
							+'<div style="border-color: rgb(241, 241, 241);" class="widget-box widget-color-orange collapsed">'
							+'<div style="background-color: rgb(241, 241, 241);" class="widget-header widget-header-small collapsed">'
							+'<span class="blue bigger-125 widget-title"> 审批路径 </span>'
							+'</div>'
							+'<div><div class="widget-main"><div class="message-header">'
							+'<table class="table  text-center"><tbody>'
							+'<tr><td class="text-left grey" style="width:25%">处理时间</td><td class="text-left grey" style="width:25%">操作人</td><td class="text-left grey" style="width:25%">状态</td><td class="text-left grey" style="width:25%">处理信息</td>';
							var temp_test = waVacationListsArr[k].wayList;
							for(var w in temp_test){
								vaListStr += '<tr><td class="text-left grey" style="width:25%">'+(temp_test[w].apprTm==undefined?'':checkNoChar(temp_test[w].apprTm))+'</td>'
								+'<td class="text-left grey" style="width:25%">'+checkNoChar(temp_test[w].apprUsrNm)+'</td>'
								+'<td class="text-left grey" style="width:25%">'+(checkNoChar(temp_test[w].status)=='1'?'已审批':'未审批')+'</td>'
								+'<td class="text-left grey" style="width:25%">'+(temp_test[w].comments==undefined?'':checkNoChar(temp_test[w].comments))+'</td>';
							}
							vaListStr+='</tbody></table>'
							+'</div></div></div>'
							+'</div></div></div>';
						}
						$('#message-list').html(vaListStr);
						
						
						
						
						
							
					
				}
			}
			
			//批量提交
			function agreeAll(){
				var checkboxs = document.getElementsByName("checkbox");
				var resultArr = [];
				var subVal = '';
				var vaSubJSON;
				var pernr1 = localStorage.pernrBase;
							if(undefined == pernr1 || null == pernr1 || '' == pernr1){
								layer.alert('用户信息获取异常，请重新登录',5);
								return;
							}
				for(var i=0;i<checkboxs.length;i++){
					if(checkboxs[i].checked){
						subVal = checkboxs[i].value;
						subVal = subVal.split(',');
							var paramJSon = {
								"input":{
									"channelSerialNo":getDateNumber(),
									"currUsrId":parseInt(pernr1).toString(),
									"domain":"400",
									"extendMap":{
										"entry":[{
											"Key":"",
											"Value":""
										}]
									},
									"bussType":"2001",
									"bussNo":subVal[3],
									"pubAppr":{
										"taskId":subVal[4],
										"appType":'AG',
										"appOpinion":'',
										"usrId":parseInt(pernr1).toString(),
										"currStep":subVal[5]
									}
								}
						};
						vaSubJSON = submit_8_6(paramJSon);
						if(vaSubJSON.status == '-1'){
							resultArr.push({status:'-1',bussNo:subVal[3]});
						}else{
							resultArr.push({status:'0',bussNo:subVal[3]});
						}
					}
				}
				
				//resultArr
				if(resultArr.length == 0){
					layer.alert('请选择待办事项',5);
				}else{
					layer.alert('提交成功',9,function(){
					window.location.href = '/web/waVacation.html';
				});
				}
			}
		</script>
		<!---这是列表的js--->
        <!--[if !IE]> -->
		<script type="text/javascript">
			window.jQuery || document.write("<script src='./assets/js/jquery.min.js'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='./assets/js/jquery1x.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

		<!-- inline scripts related to this page -->
		<script type="text/javascript">
			jQuery(function($){
			
				//handling tabs and loading/displaying relevant messages and forms
				//not needed if using the alternative view, as described in docs
				
				
				
				//页面初始化
$.ajaxSetup({
	contentType: 'application/json',
	async:false,
	error:function(){
		alert(errMsg1);
	},
	timeout:timeout
 });
				//1获取休假待办列表和条数
				var waVacationListsJSON = submit_8_4(localStorage.pernrBase?localStorage.pernrBase:'',1,10);
				if(waVacationListsJSON.status == '0'){
					var vacationCount = waVacationListsJSON.output.totalCount;
					$('#xiujiaCount').html(vacationCount);
					
					var pageAll = parseInt(vacationCount)%10 == 0?parseInt(vacationCount)/10:(parseInt(vacationCount/10)+1);
					$('#pageAll').html(pageAll);
					
					$('#pageNow').html('1');
					
					//待办休假列表数据
					var waVacationListsArr = [];
					if (waVacationListsJSON.output.waitTaskList.length == undefined) {  //只有一条数据的时候是对象，多条是数组
					
						waVacationListsArr.push(waVacationListsJSON.output.waitTaskList);
					}else{
						waVacationListsArr = waVacationListsJSON.output.waitTaskList;
					}
//待办获取的对象，还需从详情中获取部分字段展示，在此组合详情
//			<waitTaskList>
//               <reqUsrId>8101195</reqUsrId>
//               <reqUsrNm>徐锐</reqUsrNm>
//               <bussTyp>2001</bussTyp>
//               <bussNo>100000000424</bussNo>
//               <status>01</status>
//               <crtDate>2014-09-15 13:17:07</crtDate>
//               <taskId>899959d03c9711e48c4400000071d342</taskId>
//               <currStep>2</currStep>
//            </waitTaskList>
						var temp_bussNo = '';
						var temp_detail;
						var temp_per_detail;
						var temp_per;
						var temp_way;
						var temp_waysList;
						for(var k in waVacationListsArr){
							temp_bussNo = waVacationListsArr[k].bussNo;
							temp_per = waVacationListsArr[k].reqUsrId
							//获取休假详情
							temp_detail = submit_8_5(temp_bussNo);
							temp_per_detail = submit_5_3(temp_per);
							temp_way = submit_8_8(localStorage.pernrBase?localStorage.pernrBase:'',temp_bussNo);
							temp_waysList = temp_way.output.procApprInfoList.length == undefined?[].push(temp_way.output.procApprInfoList):temp_way.output.procApprInfoList;
							if(temp_detail.status == '0'){
								$.extend(waVacationListsArr[k],temp_detail.WF_P2001.item[0]);
								$.extend(waVacationListsArr[k],{attLists:temp_detail.FORM_TAB});
								$.extend(waVacationListsArr[k],temp_per_detail.EASY_TAB.item[0]);
								$.extend(waVacationListsArr[k],{wayList:temp_waysList});
							}
						}
						
						localStorage.removeItem("waVacationListsArr");
						localStorage.setItem("waVacationListsArr",JSON.stringify(waVacationListsArr));
						
						//构建列表
						
						var vaListStr = '<div class="message-item message-unread" style="background-color:#EFF7F7">'
						+'<table width="100%"><tbody><tr><td class="text-left" width="10%"> <label class="inline middle">'
						+'<input type="checkbox" id="id-toggle-all" class="ace"><span class="lbl"></span></label>全选</td>'
						+'<td class="text-left" width="10%"> 申请人</td><td class="text-left" width="10%">休假类型</td>'
						+'<td class="text-left" width="27%">休假时间</td><td class="text-left" width="30%">休假事由</td>'
						+'<td class="text-right">提交日期</td></tr>'
						+'</tbody></table></div>';
						var vaTimeShow = '';
						
						for(var k in waVacationListsArr){
							var fjListStr = '';
							var fjArr = [];
							var fjArr1 = [];
							if(checkNoChar(waVacationListsArr[k].ALLDF) == 'X'){
								vaTimeShow = checkNoChar(waVacationListsArr[k].BEGDA)+' 至 '+checkNoChar(waVacationListsArr[k].ENDDA);
							}else{
								vaTimeShow = checkNoChar(waVacationListsArr[k].BEGDA)+' '+cutSecond(checkNoChar(waVacationListsArr[k].BEGUZ))+' 至 '+checkNoChar(waVacationListsArr[k].ENDDA)+' '+cutSecond(checkNoChar(waVacationListsArr[k].ENDUZ));
							}
							
							if(undefined == waVacationListsArr[k].attLists || undefined == waVacationListsArr[k].attLists.item){
								
							}else{
								if(waVacationListsArr[k].attLists.item.length == undefined){
									fjArr.push(waVacationListsArr[k].attLists.item);
								}else{
									fjArr = waVacationListsArr[k].attLists.item;
								}
								for(var fj in fjArr){
									fjListStr += '<a href="http://'+localHostIp+'/zhr/ZHR_DOWNLOAD_DOCUMENT?DOC_ID='+checkNoChar(fjArr[fj].DOC_ID)+'">'
									+(checkNoChar(fjArr[fj].DOU_NAME) == ''?'未命名':checkNoChar(fjArr[fj].DOU_NAME))
									+'</a><br/>';
								}
							}
							
							vaListStr += '<div class="message-item message-unread">'
							+'<table width="100%">'
							+'<tbody>'
							+'<tr onclick="showCon(\''+k+'\')" style="cursor:pointer;">'
							+'<td class="text-left" width="10%">'
							+'<label class="inline middle">'
							+'<input type="checkbox"  class="ace" name="checkbox" value="'+k+',AG,'+checkNoChar(waVacationListsArr[k].status)+','+checkNoChar(waVacationListsArr[k].bussNo)+','+checkNoChar(waVacationListsArr[k].taskId)+','+checkNoChar(waVacationListsArr[k].currStep)+'"/>'
							+'<span class="lbl"></span>'
							+'</label>'
							+'</td>'
							+'<td class="text-left"  width="10%"> '+checkNoChar(waVacationListsArr[k].reqUsrNm)+'</td>'
							+'<td class="text-left"  width="10%">'+checkNoChar(waVacationListsArr[k].ATEXT)+'</td>'
							+'<td class="text-left"  width="27%">'+vaTimeShow+'</td>'
							+'<td class="text-left"  width="30%">'+checkNoChar(waVacationListsArr[k].REASON)+'</td>'
							+'<td class="text-right">'+checkNoChar(waVacationListsArr[k].crtDate)+'</td>'
							+'</tr>'
							+'</tbody>'
							+'</table>'
							//下面是详情部分
							
							
							
							+'<div class="message-content" id="content'+k+'" style="display:none">'
							+'<div style="border-color: rgb(241, 241, 241);" class="widget-box widget-color-orange collapsed">'
							+'<div style="background-color: rgb(241, 241, 241);" class="widget-header widget-header-small collapsed">'
							+'<span class="blue bigger-125 widget-title"> 基本信息 </span>'
							+'</div>'
							+'<div><div class="widget-main"><div class="message-header">'
							+'<table class="table  text-center"><tbody>'
							+'<tr><td class="text-right grey">申请人</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].reqUsrNm)+' '+parseInt(checkNoChar(waVacationListsArr[k].reqUsrId))+'</td></tr>'
							+'<tr><td class="text-right grey">公司</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].BUTXT)+'</td></tr>'
							+'<tr><td class="text-right grey">部门</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].BUMEN)+'</td></tr>'
							+'<tr><td class="text-right grey">岗位</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].PLSTX)+'</td></tr>'
							+'<tr><td class="text-right grey">休假类型</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].ATEXT)+'</td></tr>'
							+'<tr><td class="text-right grey">休假时间</td>'
							+'<td class="text-left">'+vaTimeShow+'</td></tr>'
							+'<tr><td class="text-right grey">休假天数</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].ABWTG)+'天</td></tr>'
							+'<tr><td class="text-right grey">休假事由</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].REASON)+'</td></tr>'
							+'<tr><td class="text-right grey">假期联系电话</td>'
							+'<td class="text-left">'+checkNoChar(waVacationListsArr[k].COMM)+'</td></tr>'
							+'<tr><td class="text-right grey">附件下载</td>'
							+'<td class="text-left">'+fjListStr+'</td></tr>'
							+'</tbody></table>'
							+'</div></div></div></div>'
							
							
							
							+'<div class="message-header"><div class="row">'
							+'<div class="col-md-7 col-md-push-0"><input id="form-field-'+k+'" class="col-md-12" type="text" placeholder="同意"></div>'
							+'<div class="col-md-5 col-md-pull-0 text-right">'
							+'<span id="bhBtn" class="btn btn-info btn-sm tooltip-info" title="" onclick="submitVa(\''+k+'\',\'RT\',\''+checkNoChar(waVacationListsArr[k].status)+'\',\''+checkNoChar(waVacationListsArr[k].bussNo)+'\',\''+checkNoChar(waVacationListsArr[k].taskId)+'\',\''+checkNoChar(waVacationListsArr[k].currStep)+'\')" data-placement="bottom" data-rel="tooltip" style="margin-right:3px">驳回</span>'
							+'<span id="bhBtn" class="btn btn-info btn-sm tooltip-info" title="" onclick="submitVa(\''+k+'\',\'RF\',\''+checkNoChar(waVacationListsArr[k].status)+'\',\''+checkNoChar(waVacationListsArr[k].bussNo)+'\',\''+checkNoChar(waVacationListsArr[k].taskId)+'\',\''+checkNoChar(waVacationListsArr[k].currStep)+'\')" data-placement="bottom" data-rel="tooltip" style="margin-right:3px">拒绝</span>'
							+'<span id="bhBtn" class="btn btn-info btn-sm tooltip-info" title="" onclick="submitVa(\''+k+'\',\'AG\',\''+checkNoChar(waVacationListsArr[k].status)+'\',\''+checkNoChar(waVacationListsArr[k].bussNo)+'\',\''+checkNoChar(waVacationListsArr[k].taskId)+'\',\''+checkNoChar(waVacationListsArr[k].currStep)+'\')" data-placement="bottom" data-rel="tooltip">同意</span>'
							+'</div></div></div>'
							+'<div style="border-color: rgb(241, 241, 241);" class="widget-box widget-color-orange collapsed">'
								+'<div style="background-color: rgb(241, 241, 241);" class="widget-header widget-header-small collapsed">'
							+'<span class="blue bigger-125 widget-title"> 审批路径 </span>'
							+'</div>'
							+'<div><div class="widget-main"><div class="message-header">'
							+'<table class="table  text-center"><tbody>'
							+'<tr><td class="text-left grey" style="width:25%">处理时间</td><td class="text-left grey" style="width:25%">操作人</td><td class="text-left grey" style="width:25%">状态</td><td class="text-left grey" style="width:25%">处理信息</td>';
							var temp_test = waVacationListsArr[k].wayList;
							for(var w in temp_test){
								vaListStr += '<tr><td class="text-left grey" style="width:25%">'+(temp_test[w].apprTm==undefined?'':checkNoChar(temp_test[w].apprTm))+'</td>'
								+'<td class="text-left grey" style="width:25%">'+checkNoChar(temp_test[w].apprUsrNm)+'</td>'
								+'<td class="text-left grey" style="width:25%">'+(checkNoChar(temp_test[w].status)=='1'?'已审批':'未审批')+'</td>'
								+'<td class="text-left grey" style="width:25%">'+(temp_test[w].comments==undefined?'':checkNoChar(temp_test[w].comments))+'</td>';
							}
							vaListStr+='</tbody></table>'
							+'</div></div></div>'
							+'</div></div></div>';
						}
						$('#message-list').html(vaListStr);
						
						
						
						
						
							
					
				}
				
				//2获取加班和考勤异常待办条数
				var jiabanCountJSON = submit_9_1(localStorage.pernrBase?localStorage.pernrBase:'','0');
				if(jiabanCountJSON.status == '0'){
					var jiabanCount = checkNoChar(jiabanCountJSON.E_2005);
					var kaoqinCount = checkNoChar(jiabanCountJSON.E_2011);
					$('#jiabanCount').html(jiabanCount?jiabanCount:'0');
					$('#kaoqinCount').html(kaoqinCount?kaoqinCount:'0');
				}
				
				
				
				
				
				
				
				
				
			
			});
		</script>
        <!---这是列表的js结束--->

		<!-- ace settings handler -->
		<script src="./assets/js/ace-extra.min.js"></script>
		<script src="./assets/js/bootstrap-tag.min.js"></script>
        <script >
        	//===========================点击展开关闭效果====================================
		function openShutManager(oSourceObj,oTargetObj,shutAble,oOpenTip,oShutTip){
		var sourceObj = typeof oSourceObj == "string" ? document.getElementById(oSourceObj) : oSourceObj;
		var targetObj = typeof oTargetObj == "string" ? document.getElementById(oTargetObj) : oTargetObj;
		var openTip = oOpenTip || "";
		var shutTip = oShutTip || "";
		if(targetObj.style.display!="none"){
		   if(shutAble) return;
		   targetObj.style.display="none";
		   if(openTip  &&  shutTip){
			sourceObj.innerHTML = shutTip; 
		   }
		} else {
		   targetObj.style.display="block";
		   if(openTip  &&  shutTip){
			sourceObj.innerHTML = openTip; 
		   }
		}
		}
        </script>
        <!---单选-->
        <script>
        	function a_click(o){
			   var as=o.parentNode.getElementsByTagName('li');
			   for(var i=0;i<as.length;i++){
				  as[i].style.backgroundColor='';
			   }
			   o.style.backgroundColor='#F5F7FA';
			}
        </script>
	</head>

	<body class="no-skin" style="font-family:Microsoft YaHei ! important">
        <div class="main-container " style=" overflow:hidden;">
				
				
            <!-- #section:basics/navbar.layout -->
            <div class="main-content " style="">
				<div class="breadcrumbs" id="breadcrumbs">
					<script type="text/javascript">
						try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
					</script>

					<ul class="breadcrumb">
						<li>
							<i class="ace-icon fa fa-home home-icon"></i>
							<a href="http://cpd.cttq.com:50000/irj/portal/">企业信息门户</a>
						</li>

						<li>
							<a href="#">统一待办</a>
						</li>
					</ul><!-- /.breadcrumb -->
					<!-- /section:basics/content.searchbox -->
				</div>
				<div class="page-content">
				<div class="page-content-area">
						<div class="page-header">
							<h1>
								休假审批
							</h1>
						</div>
				</div>
            <div class="row">
            	<div class="col-sm-12">
                	<div class="row">
                               
                        <div class="col-sm-3">
                            <!-- #section:elements.tab.option -->
                            <div class="widget-body">
                            <div class="tabbable">
                                
            
                                <div class="tab-content donder">
                                    <div id="home4" class="tab-pane in active">
                                    
            
                                        <ul class="list-unstyled" id="container_ul_1">
                                            <li class="message-item"  onclick="javascript:a_click(this);" style="background-color: rgb(245, 247, 250);">
                                                <a href="#"><table width="100%" border="0" cellpadding="0">
                                                    <tr>
                                                        
                                                        <td class="text-left bigger-125 ">休假审批</td>
                                                        <td width="30%" class="text-right bigger-150" id="xiujiaCount">0</td>
                                                    </tr>
                                                </table>  
                                                </a>
                                            </li>
                                            <li class="message-item"  onclick="javascript:a_click(this);">
                                                <a href="#" onclick="window.location.href='/web/waOvertime.html'"><table width="100%" border="0" cellpadding="0">
                                                    <tr>
                                                        
                                                        <td class="text-left bigger-125 ">加班审批</td>
                                                        <td width="30%" class="text-right bigger-150" id="jiabanCount">0</td>
                                                    </tr>
                                                </table>  
                                                </a>
                                            </li>
											 <li class="message-item"  onclick="javascript:a_click(this);">
                                                <a href="#" onclick="window.location.href='/web/waError.html'"><table width="100%" border="0" cellpadding="0">
                                                    <tr>
                                                        
                                                        <td class="text-left bigger-125 ">考勤异常审批</td>
                                                        <td width="30%" class="text-right bigger-150" id="kaoqinCount">0</td>
                                                    </tr>
                                                </table>  
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
									<style>
                                    .donder a{TEXT-DECORATION:none;}
                                    .donder a:hover{TEXT-DECORATION:none}
                                    .donder a:active{text-decoration:none;}
                                    
                                    .donder a:link{text-decoration:none;}
                                    .donder a:visited{text-decoration:none;}
                                    
                                    </style>
                                </div>
                            </div>
                            </div>
                        </div><!-- /.col -->
            
                        <div class="col-sm-9">
                        
                        <!----列表--->
                        <div class="tabbable donder">
                                <div class="tab-content no-border no-padding">
                                    <div  class="tab-pane in active">
                                        <div class="message-container">
                                            <!-- #section:pages/inbox.navbar -->
                                            <div id="id-message-list-navbar" class="message-navbar clearfix">
														<div class="message-bar">
															<div class="message-infobar" id="id-message-infobar">
																<span class="blue bigger-150">待办休假列表</span>
																<span class="grey bigger-110"></span>
															</div>

															<div class="message-toolbar hide">
																<div class="inline position-relative align-left">
																	

																	
																</div>

																

																
															</div>
														</div>

														<div>
															

															<div class="messagebar-item-right">
																<div class="inline position-relative">
																	<span class="btn btn-info btn-sm tooltip-info text-center" data-rel="tooltip"  data-placement="bottom" title="" onclick="agreeAll()">同意</span>

																	
																</div>
															</div>

															<!-- #section:pages/inbox.navbar-search -->
															<!--div class="nav-search minimized">
																<form class="form-search">
																	<span class="input-icon">
																		<input type="text" autocomplete="off" class="input-small nav-search-input" placeholder="Search inbox ..." />
																		<i class="ace-icon fa fa-search nav-search-icon"></i>
																	</span>
																</form>
															</div-->

															<!-- /section:pages/inbox.navbar-search -->
														</div>
													</div>
                                            
            
                                            
            
                                            
            
            
                                            <!-- /section:pages/inbox.navbar -->
                                            <div class="message-list-container">
                                                <!-- #section:pages/inbox.message-list -->
                                                <div class="message-list" id="message-list">
                                                    <!-- #section:pages/inbox.message-list.item -->
                                                    <div class="message-item message-unread" style="background-color:#EFF7F7">
                                                    	
                                                        <table width="100%">
                                                        	<tr>
                                                            	<td class="text-left" width="10%"> 
                                                                	<label class="inline middle">
                                                                        <input type="checkbox" id="id-toggle-all" class="ace" />
                                                                        <span class="lbl"></span>
                                                                    </label>全选
                                                        		</td>
                                                                <td class="text-left"  width="10%"> 申请人</td>
                                                                <td class="text-left"  width="10%">休假类型</td>
                                                                <td class="text-left"  width="27%">休假时间</td>
                                                                <td class="text-left"  width="30%">休假事由</td>
                                                                <td class="text-right">提交日期</td>
                                                            </tr>
                                                        
                                                        </table>
                                                    </div>
            
                                                    <!-- /section:pages/inbox.message-list.item -->
                                                    <!--div class="message-item message-unread">
                                                    	
                                                    	<table width="100%">
                                                        	<tr>
                                                            	<td class="text-left" width="10%"> 
                                                                	<label class="inline middle">
                                                                        <input type="checkbox"  class="ace" />
                                                                        <span class="lbl"></span>
                                                                    </label>
                                                        		</td>
                                                                <a href="####" class="text">
                                                                <td class="text-left"  width="20%"> 申请人</td>
                                                                <td class="text-left"  width="25%">差旅时间</td>
                                                                <td class="text-left"  width="20%">差旅地点</td>
                                                                <td class="text-left"  width="15%">差旅事由</td>
                                                                <td class="text-right">提交日期</td>
                                                                </a>
                                                            </tr>
                                                        
                                                        </table>
                                                        
                                                        
                                                    </div-->
                                                    <!-- #section:pages/inbox.message-list.item -->
                                                    <!--div class="message-item message-unread">
                                                    	
                                                    	<table width="100%">
                                                        	<tr>
                                                            	<td class="text-left" width="10%"> 
                                                                	<label class="inline middle">
                                                                        <input type="checkbox"  class="ace" />
                                                                        <span class="lbl"></span>
                                                                    </label>
                                                        		</td>
                                                                <a href="####" class="text">
                                                                <td class="text-left"  width="20%"> 申请人</td>
                                                                <td class="text-left"  width="25%">差旅时间</td>
                                                                <td class="text-left"  width="20%">差旅地点</td>
                                                                <td class="text-left"  width="15%">差旅事由</td>
                                                                <td class="text-right">提交日期</td>
                                                                </a>
                                                            </tr>
                                                        
                                                        </table>
                                                        
                                                    </div>
                                                    
                                                </div-->
            
                                                <!-- /section:pages/inbox.message-list -->
                                            </div>
                                            <div class="hide message-content" id="id-message-content">
                                                <!-- #section:pages/inbox.message-header -->
                                                <div class="widget-box widget-color-orange collapsed"  style="border-color:#F1F1F1;">
                                                        <!-- #section:custom/widget-box.options.collapsed -->
                                                        <div class="widget-header widget-header-small collapsed" style=" background-color:#F1F1F1">
                                                            <span class="blue bigger-125 widget-title"> 基本信息 </span>
                                                            
                                                        </div>
                
                                                        <!-- /section:custom/widget-box.options.collapsed -->
                                                        <div >
                                                            <div class="widget-main">
                                                                <div class="message-header">
                                                                <style>
                                                                .table tr.last td{ border-top:0px solid blue;}
                                                                </style>
                                                    <table class="table  text-center">
                                                         <tr>
                                                             <td class="text-right grey">申请人</td>
                                                            <td class="text-left" id="sqr"></td>
                                                         </tr>
                                                         <tr>
                                                            <td class="text-right grey">公司</td>
                                                            <td class="text-left" id="gs"></td>
                                                         </tr>
                                                         <tr>
                                                            <td class="text-right grey">部门</td>
                                                            <td class="text-left" id="bm"></td>
                                                         </tr>
                                                         <tr>
                                                            <td class="text-right grey">岗位</td>
                                                            <td class="text-left" id="gw"></td>
                                                         </tr>
														 <tr>
                                                            <td class="text-right grey">休假类型</td>
                                                            <td class="text-left" id="xjlx"></td>
                                                         </tr>
														 <tr>
                                                            <td class="text-right grey">休假时间</td>
                                                            <td class="text-left" id="xjsj"></td>
                                                         </tr>
														 <tr>
                                                            <td class="text-right grey">休假天数</td>
                                                            <td class="text-left" id="xjts"></td>
                                                         </tr>
														 <tr>
                                                            <td class="text-right grey">休假事由</td>
                                                            <td class="text-left" id="xjsy"></td>
                                                         </tr>
														 <tr>
                                                            <td class="text-right grey">假期联系电话</td>
                                                            <td class="text-left" id="jqlxdh"></td>
                                                         </tr>
														 <tr>
                                                            <td class="text-right grey">附件下载</td>
                                                            <td class="text-left" id="fjxz"></td>
                                                         </tr>
														
                                                    </table>
                                                        
                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                
                                                <!-- #section:pages/inbox.message-body -->
                                           
                                                
                
                                                <!-- #section:pages/inbox.message-attachment -->
                                                <!--div class="message-header">
                                                        
                                                        <div class="widget-box widget-color-orange collapsed  "  style="border-color:#F1F1F1;">
                                                        <div class=" widget-header-small " style=" background-color:#F1F1F1">
                                                            <span class="blue  bigger-125 widget-title"> 发票信息 </span>
                                                            
                                                            <div class="widget-toolbar no-border" style=" background-color:#F1F1F1">
                                                                <a href="###" onclick="openShutManager(this,'box1',false,'点击关闭','点击展开')">点击展开</a>
                                                            </div>
                                                        </div>
                                                        <div >
                                                            <div class="widget-main" style="display:none; font-weight:" id="box1">
                                                                <p class="alert alert-info">
                                                                 暂无信息
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                </div-->
                
                                                <!-- /section:pages/inbox.message-attachment -->
                                                <!--div class="message-header">
                                                        
                                                        <div class="widget-box widget-color-orange collapsed"  style="border-color:#F1F1F1;">
                                                        <div class="widget-header widget-header-small collapsed" style=" background-color:#F1F1F1">
                                                            <span class="blue  bigger-125 widget-title"> 审批记录 </span>
                                                                
                                                            <div class="widget-toolbar no-border ">
                                                                <a href="###" onclick="openShutManager(this,'box3',false,'点击关闭','点击展开')">点击展开</a>
                                                            </div>
                                                        </div>
                                                        
                                                        <div style="display:none;" id="box3">
                                                                
                                                                <div class="widget-main">
                                                                <style>
                                                                    .widget-main span{ margin-left:65px; line-height:30px;}
                                                                    .xian{ width:95%; margin:0 auto; background-color:#CCC; height:1px;}
                                                                </style>
                                                                             <p style=" margin-top:10x;">
                                                                                <span class="grey">3</span>
                                                                                <span class="text-right grey">胡维洁维洁</span>
                                                                                <span class="grey">2014-07-02 19:04:43</span>
                                                                                <span class="grey">null</span>
                                                                                <span class="grey">核准金额：10000</span>
                                                                                <br>
                                                                                <span>&nbsp;&nbsp;&nbsp;</span><span class="text-right grey">审批意见：12345678</span>
                                                                                <div class="xian"></div>
                                                                             </p>
                                                                             
                                                                              
                                                                                
                                                                </div>
                                                                
                                                                
                                                                
                                                        </div>
                                                    </div>
                                                        
                                                        
                                                    
                                                </div-->
                                                
                                                <!-- /section:pages/inbox.message-attachment -->
                                                <div class="message-header">
                                                    <div class="row">
                                                              <div class="col-md-7 col-md-push-0"><input type="text" id="form-field-1" placeholder="同意" class="col-md-12"></div>
                                                              <div class="col-md-5 col-md-pull-0 text-right">
                                                                <span class="btn btn-info btn-sm tooltip-info" data-rel="tooltip" data-placement="bottom" title="" id="bhBtn">驳回</span>
                                                                <span class="btn btn-info btn-sm tooltip-info" data-rel="tooltip" data-placement="bottom" title="" id="jjBtn">拒绝</span>
                                                                <span class="btn btn-info btn-sm tooltip-info" data-rel="tooltip" data-placement="bottom" title="" id="tyBtn">同意</span>
                                                              </div>
                                                            </div>
                
                                                        
                                                        
                                                    
                                                    
                                                    
                                                </div>
                                                
                                                 <!----->
                                            </div>
            
                                            <!-- #section:pages/inbox.message-footer -->
                                            <div class="message-footer clearfix">
                                                <div class="pull-left"> 共<span id="pageAll">0</span>页 </div>
            
                                                <div class="pull-right">
                                                    <div class="inline middle">  </div>
            
                                                    &nbsp; &nbsp;
                                                    <ul class="pagination middle">
                                                        <li >
                                                            <a href="###" onclick="changePage('1')">
                                                                <i class="ace-icon fa fa-step-backward middle"></i>
                                                            </a>
                                                        </li>
            
                                                        <li>
                                                            <a href="###" onclick="changePage('2')">
                                                                <i class="ace-icon fa fa-caret-left bigger-140 middle"></i>
                                                            </a>
                                                        </li>
            
                                                        <li>
                                                           <span id="pageNow">1</span>
                                                        </li>
            
                                                        <li>
                                                            <a href="###" onclick="changePage('3')">
                                                                <i class="ace-icon fa fa-caret-right bigger-140 middle"></i>
                                                            </a>
                                                        </li>
            
                                                        <li>
                                                            <a href="###" onclick="changePage('4')">
                                                                <i class="ace-icon fa fa-step-forward middle"></i>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
            
                                            
            
                                            <!-- /section:pages/inbox.message-footer -->
                                        </div>
                                    </div>
                                </div><!-- /.tab-content -->
                            </div>
                        <!---修改--->
                        
                        </div>
                    </div>
                </div>
            </div>
			 </div>
    		</div>
            <!-- /section:basics/navbar.layout -->
        </div>
		
		
		
		<script type="text/javascript">
			jQuery(function($){
				$('#inbox-tabs a[data-toggle="tab"]').on('show.bs.tab', function (e) {
					var currentTab = $(e.target).data('target');
					if(currentTab == 'write') {
						Inbox.show_form();
					}
					else if(currentTab == 'inbox') {
						Inbox.show_list();
					}
				})
			
			
				
				//basic initializations
				$('.message-list .message-item input[type=checkbox]').removeAttr('checked');
				$('.message-list').on('click', '.message-item input[type=checkbox]' , function() {
					$(this).closest('.message-item').toggleClass('selected');
					if(this.checked) Inbox.display_bar(1);//display action toolbar when a message is selected
					else {
						Inbox.display_bar($('.message-list input[type=checkbox]:checked').length);
						//determine number of selected messages and display/hide action toolbar accordingly
					}		
				});
			
			
				//check/uncheck all messages
				$('#id-toggle-all').removeAttr('checked').on('click', function(){
					if(this.checked) {
						Inbox.select_all();
					} else Inbox.select_none();
				});
				
				//select all
				$('#id-select-message-all').on('click', function(e) {
					e.preventDefault();
					Inbox.select_all();
				});
				
				//select none
				$('#id-select-message-none').on('click', function(e) {
					e.preventDefault();
					Inbox.select_none();
				});
				
				//select read
				$('#id-select-message-read').on('click', function(e) {
					e.preventDefault();
					Inbox.select_read();
				});
			
				//select unread
				$('#id-select-message-unread').on('click', function(e) {
					e.preventDefault();
					Inbox.select_unread();
				});
			
				/////////
			
				//display first message in a new area
				$('.message-list .message-item:eq(0) .text').on('click', function() {
					//show the loading icon
					$('.message-container').append('<div class="message-loading-overlay"><i class="fa-spin ace-icon fa fa-spinner orange2 bigger-160"></i></div>');
					
					$('.message-inline-open').removeClass('message-inline-open').find('.message-content').remove();
			
					var message_list = $(this).closest('.message-list');
			
					$('#inbox-tabs a[href="#inbox"]').parent().removeClass('active');
					//some waiting
					setTimeout(function() {
			
						//hide everything that is after .message-list (which is either .message-content or .message-form)
						message_list.next().addClass('hide');
						$('.message-container').find('.message-loading-overlay').remove();
			
						//close and remove the inline opened message if any!
			
						//hide all navbars
						$('.message-navbar').addClass('hide');
						//now show the navbar for single message item
						$('#id-message-item-navbar').removeClass('hide');
			
						//hide all footers
						$('.message-footer').addClass('hide');
						//now show the alternative footer
						$('.message-footer-style2').removeClass('hide');
						
						
						//move .message-content next to .message-list and hide .message-list
						$('.message-content').removeClass('hide').insertAfter(message_list.addClass('hide'));
			
						//add scrollbars to .message-body
						$('.message-content .message-body').ace_scroll({
							size: 150,
							mouseWheelLock: true,
							styleClass: 'scroll-visible'
						});
			
					}, 500 + parseInt(Math.random() * 500));
				});
			
			
				//display second message right inside the message list
				var waVacationListsArr = JSON.parse(localStorage.getItem("waVacationListsArr"));
				var vaTimeShow = '';
			
				//back to message list
				$('.btn-back-message-list').on('click', function(e) {
					
					e.preventDefault();
					$('#inbox-tabs a[href="#inbox"]').tab('show');
				});
			
			
			
				//hide message list and display new message form
				/**
				$('.btn-new-mail').on('click', function(e){
					e.preventDefault();
					Inbox.show_form();
				});
				*/
			
			
			
			
				var Inbox = {
					//displays a toolbar according to the number of selected messages
					display_bar : function (count) {
						if(count == 0) {
							$('#id-toggle-all').removeAttr('checked');
							$('#id-message-list-navbar .message-toolbar').addClass('hide');
							$('#id-message-list-navbar .message-infobar').removeClass('hide');
						}
						else {
							$('#id-message-list-navbar .message-infobar').addClass('hide');
							$('#id-message-list-navbar .message-toolbar').removeClass('hide');
						}
					}
					,
					select_all : function() {
						var count = 0;
						$('.message-item input[type=checkbox]').each(function(){
							this.checked = true;
							$(this).closest('.message-item').addClass('selected');
							count++;
						});
						
						$('#id-toggle-all').get(0).checked = true;
						
						Inbox.display_bar(count);
					}
					,
					select_none : function() {
						$('.message-item input[type=checkbox]').removeAttr('checked').closest('.message-item').removeClass('selected');
						$('#id-toggle-all').get(0).checked = false;
						
						Inbox.display_bar(0);
					}
					,
					select_read : function() {
						$('.message-unread input[type=checkbox]').removeAttr('checked').closest('.message-item').removeClass('selected');
						
						var count = 0;
						$('.message-item:not(.message-unread) input[type=checkbox]').each(function(){
							this.checked = true;
							$(this).closest('.message-item').addClass('selected');
							count++;
						});
						Inbox.display_bar(count);
					}
					,
					select_unread : function() {
						$('.message-item:not(.message-unread) input[type=checkbox]').removeAttr('checked').closest('.message-item').removeClass('selected');
						
						var count = 0;
						$('.message-unread input[type=checkbox]').each(function(){
							this.checked = true;
							$(this).closest('.message-item').addClass('selected');
							count++;
						});
						
						Inbox.display_bar(count);
					}
				}
			
				//show message list (back from writing mail or reading a message)
				Inbox.show_list = function() {
					$('.message-navbar').addClass('hide');
					$('#id-message-list-navbar').removeClass('hide');
			
					$('.message-footer').addClass('hide');
					$('.message-footer:not(.message-footer-style2)').removeClass('hide');
			
					$('.message-list').removeClass('hide').next().addClass('hide');
					//hide the message item / new message window and go back to list
				}
			
				//show write mail form
				Inbox.show_form = function() {
					if($('.message-form').is(':visible')) return;
					if(!form_initialized) {
						initialize_form();
					}
					
					
					var message = $('.message-list');
					$('.message-container').append('<div class="message-loading-overlay"><i class="fa-spin ace-icon fa fa-spinner orange2 bigger-160"></i></div>');
					
					setTimeout(function() {
						message.next().addClass('hide');
						
						$('.message-container').find('.message-loading-overlay').remove();
						
						$('.message-list').addClass('hide');
						$('.message-footer').addClass('hide');
						$('.message-form').removeClass('hide').insertAfter('.message-list');
						
						$('.message-navbar').addClass('hide');
						$('#id-message-new-navbar').removeClass('hide');
						
						
						//reset form??
						$('.message-form .wysiwyg-editor').empty();
					
						$('.message-form .ace-file-input').closest('.file-input-container:not(:first-child)').remove();
						$('.message-form input[type=file]').ace_file_input('reset_input');
						
						$('.message-form').get(0).reset();
						
					}, 300 + parseInt(Math.random() * 300));
				}
			
			
			
			
				var form_initialized = false;
				function initialize_form() {
					if(form_initialized) return;
					form_initialized = true;
					
					//intialize wysiwyg editor
					$('.message-form .wysiwyg-editor').ace_wysiwyg({
						toolbar:
						[
							'bold',
							'italic',
							'strikethrough',
							'underline',
							null,
							'justifyleft',
							'justifycenter',
							'justifyright',
							null,
							'createLink',
							'unlink',
							null,
							'undo',
							'redo'
						]
					}).prev().addClass('wysiwyg-style1');
			
			
			
					//file input
					$('.message-form input[type=file]').ace_file_input()
					.closest('.ace-file-input')
					.addClass('width-90 inline')
					.wrap('<div class="form-group file-input-container"><div class="col-sm-7"></div></div>');
			
					//Add Attachment
					//the button to add a new file input
					$('#id-add-attachment')
					.on('click', function(){
						var file = $('<input type="file" name="attachment[]" />').appendTo('#form-attachments');
						file.ace_file_input();
						
						file.closest('.ace-file-input')
						.addClass('width-90 inline')
						.wrap('<div class="form-group file-input-container"><div class="col-sm-7"></div></div>')
						.parent().append('<div class="action-buttons pull-right col-xs-1">\
							<a href="#" data-action="delete" class="middle">\
								<i class="ace-icon fa fa-trash-o red bigger-130 middle"></i>\
							</a>\
						</div>')
						.find('a[data-action=delete]').on('click', function(e){
							//the button that removes the newly inserted file input
							e.preventDefault();
							$(this).closest('.file-input-container').hide(300, function(){ $(this).remove() });
						});
					});
				}//initialize_form
			
				//turn the recipient field into a tag input field!
				/**	
				var tag_input = $('#form-field-recipient');
				try { 
					tag_input.tag({placeholder:tag_input.attr('placeholder')});
				} catch(e) {}
			
			
				//and add form reset functionality
				$('#id-message-form').on('reset', function(){
					$('.message-form .message-body').empty();
					
					$('.message-form .ace-file-input:not(:first-child)').remove();
					$('.message-form input[type=file]').ace_file_input('reset_input_ui');
			
					var val = tag_input.data('value');
					tag_input.parent().find('.tag').remove();
					$(val.split(',')).each(function(k,v){
						tag_input.before('<span class="tag">'+v+'<button class="close" type="button">&times;</button></span>');
					});
				});
				*/
			});
		</script>
    </body>
</html>
