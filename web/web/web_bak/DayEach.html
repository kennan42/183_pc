<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>日历每人每天提交</title>

		<meta name="description" content="Common form elements and layouts" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="./assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="./assets/css/font-awesome.min.css" />
		<link rel="stylesheet" href="./assets/css/dropzone.css" />
		<!-- page specific plugin styles -->
		<link rel="stylesheet" href="./assets/css/jquery.gritter.css" />
		<link rel="stylesheet" href="./assets/css/jquery-ui.custom.min.css" />
		<link rel="stylesheet" href="./assets/css/chosen.css" />
		<link rel="stylesheet" href="./assets/css/datepicker.css" />
		<link rel="stylesheet" href="./assets/css/bootstrap-timepicker.css" />
		<link rel="stylesheet" href="./assets/css/daterangepicker.css" />
		<link rel="stylesheet" href="./assets/css/bootstrap-datetimepicker.css" />
		<link rel="stylesheet" href="./assets/css/colorpicker.css" />
		<link rel="stylesheet" href="./assets/css/fullcalendar.css" />
		
		<!-- text fonts -->
		<link rel="stylesheet" href="./mycss/ace-btn.css" />
		<!-- text fonts -->
		<link rel="stylesheet" href="./assets/css/ace-fonts.css" />

		<!-- ace styles -->
		<script src="assets/js/ace-extra.min.js"></script>

		<style>
			.mar-t-5{
				margin-top:5px;
			}
			.mar-tt{
				margin-top:40px;
			}
		</style>

		<!-- inline styles related to this page -->
		<!-- ace settings handler -->
		<script src="./assets/js/ace-extra.min.js"></script>

		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

		<!--[if lte IE 8]>
		<script src="./assets/js/html5shiv.min.js"></script>
		<script src="./assets/js/respond.min.js"></script>
		<![endif]-->
		
		<script src='./assets/js/jquery.min.js'></script>
		<script src="./layer/layer.min.js"></script>
		<script src="./myjs/backupNew.js?v=20150831"></script>
        <script src="./myjs/lexus.js?v=20141224"></script>
		<style type="text/css">
			body {
			    background-color:#e4e6e9;
			    min-height:100%;
			    padding-bottom:0;
			    /*font-family:'Open Sans';*/
			    font-family: "Arial","Microsoft YaHei";
			    font-size:13px;
			    color:#393939;
			    line-height:1.5
			}
			.fc-state-default, .fc-state-default .fc-button-inner {
				border: none;
				background-color: #6fb3e0;
				color: #FFF;
				background-image: none;
				box-shadow: none;
				text-shadow: none;
				border-radius: 0!important;
				margin-left: 2px;
			}
			.fc-button:hover{
			background-color: #4f99c6;
			}
			.main-container:before {
			    display:block;
			    content:"";
			    position:absolute;
			    z-index:-2;
			    width:100%;
			    max-width:inherit;
			    bottom:0;
			    top:0;
			    background-color:#FFF
			}
			.main-container.container,.rtl .main-container.container {
			    padding-left:0;
			    padding-right:0
			}
			.main-container.container:before {
			    -webkit-box-shadow:0 0 0 1px rgba(0,0,0,.1);
			    box-shadow:0 0 0 1px rgba(0,0,0,.1);
			    width:inherit
			}
			.breadcrumbs {
			    position:relative;
			    z-index:auto;
			    border-bottom:1px solid #e5e5e5;
			    background-color:#f5f5f5;
			    min-height:41px;
			    line-height:40px;
			    padding:0 12px 0 0
			}
			.breadcrumb {
			    background-color:transparent;
			    display:inline-block;
			    line-height:20px;
			    margin:6px 22px 0 12px;
			    padding:0;
			    font-size:13px;
			    color:#333;
			    border-radius:0
			}
			.breadcrumb>li,.breadcrumb>li.active {
			    color:#555;
			    padding:0 3px
			}
			.breadcrumb>li>a {
			    display:inline-block;
			    color:#4c8fbd
			}
			.breadcrumb>li+li:before {
			    font-family:FontAwesome;
			    font-size:14px;
			    content:"\f105";
			    color:#b2b6bf;
			    padding:0;
			    margin:0 8px 0 0;
			    position:relative;
			    top:1px
			}
			.breadcrumb .home-icon {
			    font-size:20px;
			    margin-left:2px;
			    margin-right:2px;
			    vertical-align:top
			}
			.white {
			    color:#fff!important
			}

				.main-container.container:before {
				    -webkit-box-shadow:none;
				    box-shadow:none;
				    width:100%
				}
				.main-content {
				    margin-left:0;
				    min-height:100%;
				    padding:0
				}
				.sidebar+.main-content {
				    margin-left:190px
				}
				.page-content {
				    background-color:#fff;
				    position:relative;
				    margin:0;
				    padding:8px 20px 24px
				}
				.page-header {
				    margin:0 0 12px;
				    border-bottom:1px dotted #e2e2e2;
				    padding-bottom:16px;
				    padding-top:7px
				}
				.page-header h1 {
				    padding:0;
				    margin:0 8px;
				    font-size:24px;
				    font-weight:lighter;
				    color:#2679b5
				}
				.page-header h1 small {
				    margin:0 6px;
				    font-size:14px;
				    font-weight:400;
				    color:#8089a0
				}
				.ace-icon {
				    text-align:center
				}
			.table>thead>tr {
			    color:#707070;
			    font-weight:400;
			    background:#F2F2F2 repeat-x;
			    background-image:-webkit-linear-gradient(top,#f8f8f8 0,#ececec 100%);
			    background-image:-o-linear-gradient(top,#f8f8f8 0,#ececec 100%);
			    background-image:linear-gradient(to bottom,#f8f8f8 0,#ececec 100%);
			    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#ffececec', GradientType=0)
			}
			table#DayEach thead tr th{text-align:center;vertical-align:middle;}
			table#DayEach tbody tr td{text-align:center;padding:0;margin:0;vertical-align:middle;height:26px;}
			table#DayEach tbody tr td button{width:100%;cursor:pointer;}
			table#DayEach tbody tr td button.btn{padding:0px 3px;}
			table#DayEach tbody tr td button.btn-success{color:#87b87f!important;text-shadow:0 -1px 0 rgba(54,15,60,0)!important;}
			table#DayEach tbody tr td button.btn-success:hover{color:#629b58!important;}
			table#DayEach tbody tr td button.btn-grey{color:#a0a0a0!important;text-shadow:0 -1px 0 rgba(54,15,60,0)!important;}
			table#DayEach tbody tr td button.btn-grey:hover{color:#888!important;}
			.table-bordered>thead>tr>td, .table-bordered>thead>tr>th{border-bottom-width:1px;}
			.row{margin:0;}
			.dropdown-menu{min-width:inherit;width:100%;left:12px;}
			#DayEachPlay .ColSm2{width:20%;padding:0 12px;float:left;text-align:center;}
			#DayEachPlay .col-sm-3{text-align:center;}
			#DayEachPlay .col-sm-3 button{width:100%;font-size:16px;padding:5px 10px;}
			#DayEachPlay .ColSm2 button{width:90%;font-size:14px;padding:3px 6px;}
			.xubox_shade, .xubox_layer{position:fixed;}
			#ArticleNum{position:fixed;bottom:0px;right:0px;}
			.hr{display: block;
				height: 0;
				overflow: hidden;
				font-size: 0;
				border-width: 1px 0 0;
				border-top: 1px solid #E3E3E3;
				margin: 12px 0;
				border-top-color: rgba(0,0,0,.11);
			}
			.hr-12, .hr12{margin: 12px 0;}
			.hr-solid {height: 1px;border-top: 1px solid #efefef;border-bottom: none;}
			.hr-double{height: 3px;
				border-top: 1px solid #E3E3E3;
				border-bottom: 1px solid #E3E3E3;
				border-top-color: rgba(0,0,0,.11);
				border-bottom-color: rgba(0,0,0,.11);
			}
			.xubox_title{-webkit-box-sizing: content-box;
				-moz-box-sizing: content-box;
				box-sizing: content-box;
				position: relative;
				min-height: 38px;
				background: #f7f7f7 repeat-x;
				background-image: -webkit-linear-gradient(top,#fff 0,#eee 100%);
				background-image: -o-linear-gradient(top,#fff 0,#eee 100%);
				background-image: linear-gradient(to bottom,#fff 0,#eee 100%);
				filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffffff', endColorstr='#ffeeeeee', GradientType=0);
				color: #669fc7;
				border-bottom: 1px solid #DDD;}
			.xubox_title em{height:auto;line-height:auto;left:auto;top:auto;width:auto;}
			.xubox_title i{position:relative;}
			.xubox_title h4{margin-left:12px;font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:17px;}
			.xubox_title span{margin-left:10px;}
			.gritter-item-wrapper {
			    background-image:none!important;
			    box-shadow:0 2px 10px rgba(50,50,50,.5);
			    background:rgba(50,50,50,.92)
			}
			.gritter-item-wrapper.gritter-info {
			    background:rgba(49,81,133,.92)
			}
			.gritter-item-wrapper.gritter-error {
			    background:rgba(153,40,18,.92)
			}
			.gritter-item-wrapper.gritter-success {
			    background:rgba(89,131,75,.92)
			}
			.gritter-item-wrapper.gritter-warning {
			    background:rgba(190,112,31,.92)
			}
			.gritter-item-wrapper.gritter-light {
			    background:rgba(245,245,245,.95);
			    border:1px solid #BBB
			}
			.gritter-item-wrapper.gritter-light.gritter-info {
			    background:rgba(232,242,255,.95)
			}
			.gritter-item-wrapper.gritter-light.gritter-info .gritter-item {
			    color:#4A577D
			}
			.gritter-item-wrapper.gritter-light.gritter-error {
			    background:rgba(255,235,235,.95)
			}
			.gritter-item-wrapper.gritter-light.gritter-error .gritter-item {
			    color:#894A38
			}
			.gritter-item-wrapper.gritter-light.gritter-success {
			    background:rgba(239,250,227,.95)
			}
			.gritter-item-wrapper.gritter-light.gritter-success .gritter-item {
			    color:#416131
			}
			.gritter-item-wrapper.gritter-light.gritter-warning {
			    background:rgba(252,248,227,.95)
			}
			.gritter-item-wrapper.gritter-light.gritter-warning .gritter-item {
			    color:#946446
			}
			.gritter-item p {
			    line-height:1.8
			}
			.gritter-bottom,.gritter-item,.gritter-top {
			    background-image:none
			}
			button .gritter-close{
			    left:auto;
			    right:auto;
			    background-image:none;
			    width:auto;
			    height:auto;
			    line-height:auto;
			    text-align:center;
			    border:none;
			    border-radius:auto;
			    color:auto;
			}
			.gritter-close {
			    left:auto;
			    right:3px;
			    background-image:none;
			    width:18px;
			    height:18px;
			    line-height:17px;
			    text-align:center;
			    border:2px solid transparent;
			    border-radius:16px;
			    color:#E17B67
			}
			.gritter-close:before {
			    font-family:FontAwesome;
			    font-size:16px;
			    content:"\f00d"
			}
			.gritter-info .gritter-close {
			    color:orange
			}
			.gritter-error .gritter-close,.gritter-success .gritter-close,.gritter-warning .gritter-close {
			    color:#FFEA07
			}
			.gritter-close:hover {
			    color:#FFF!important
			}
			.gritter-title {
			    text-shadow:none
			}
			.gritter-light .gritter-bottom,.gritter-light .gritter-close,.gritter-light .gritter-item,.gritter-light .gritter-top {
			    background-image:none;
			    color:#444
			}
			.gritter-light .gritter-title {
			    text-shadow:none
			}
			.gritter-light .gritter-close:hover {
			    color:#8A3104!important
			}
			.gritter-center {
			    position:fixed;
			    left:33%;
			    right:33%;
			    top:33%;
			    
			}
		</style>

		<script type="text/javascript">
		</script>
	</head>

	<body class="no-skin">
		<div id="Loading" style="">		
		</div>
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<!-- /section:basics/sidebar -->
			<div class="main-content">
				<!-- #section:basics/content.breadcrumbs -->
				<div class="breadcrumbs" id="breadcrumbs" style="background:#438eb9;">
					<script type="text/javascript">
						try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
					</script>

					<ul class="breadcrumb">
						<li>
							<i class="ace-icon fa fa-home home-icon white"></i>
							<a href="#" id="qiyemenghu" onclick="MHUrl()" class="white">企业信息门户</a>
						</li>

						<li>
							<a href="#" class="white">员工自助</a>
						</li>
					</ul><!-- /.breadcrumb -->

					<!-- /section:basics/content.searchbox -->
				</div>

				<!-- /section:basics/content.breadcrumbs -->
				<div class="page-content">
					<!-- #section:settings.box -->
					

					<!-- /section:settings.box -->
					<div class="page-content-area">
						<div class="page-header" style="border-bottom:solid 1px #438eb9;">
							<input type="hidden" id="begD" value="">
							<input type="hidden" id="endD" value="">
							<h1 style="font-family:Microsoft YaHei ! important;">
								填报月度考勤表
								<small>
									<i class="ace-icon fa fa-angle-double-right"></i>
									每月1-8日填报上月销售人员考勤表，超过填报的考勤期间只能查询该表，如仍需处理该月考勤请联系人力资源部薪资专员
								</small>
								<button class="btn btn-sm btn-primary" style="float:right;">&nbsp;&nbsp;帮&nbsp;&nbsp;&nbsp;&nbsp;助&nbsp;&nbsp;</button>
							</h1>
						</div>

						<div class="row">
							<div class="col-xs-12" style="position:relative;">
								<div class="col-xs-12">
									<div style="width:225px;margin:16px auto;overflow:hidden;">
										<span class="fc-button fc-button-prev fc-state-default fc-corner-left" unselectable="on" style="float:left;" onclick="lastMonth()">
											<span class="fc-icon fc-icon-left-single-arrow"></span>
										</span>
										<h3 style="float:left;margin:0 10px;"><span id="EachYear"></span>年<span id="EachMonth"></span>月</h3>
										<span class="fc-state-default fc-corner-right" id="NextMonthBox" unselectable="on" style="float:left;">
											<span class="fc-button fc-button-next" style="float:left;" onclick="nextMonth()">
												<span class="fc-icon fc-icon-right-single-arrow"></span>
											</span>
										</span>
									</div>
								</div>
								<table id="DayEach" class="table table-striped table-bordered table-hover">
									<thead>
										<tr>
											<th rowspan="2">人员编号</th>
											<th rowspan="2">姓名</th>
											
										</tr>
										<tr>
											
										</tr>
									</thead>
									<tbody>
										
									</tbody>
								</table>
								<div class="col-xs-12">
									<div id="ArticleNum">
										[<span></span>/<span></span>]
									</div>
									<div class="col-xs-3" style="float:none;margin:20px auto;padding:0;width:220px;">
										<button class="btn btn-block btn-primary" style="width:220px;" id="ASubmitBtn" onclick="ASubmitBtn(this);">提&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交</button>
									</div>
								</div>
								<div id="DayEachPlay" style="width:560px;padding:.5em 1em;display:none;">
									<div class="row">
										<h4 style="margin-top:10px;margin-bottom:0;font-size:21px;padding:0 18px;"><span id="PYearMonth"></span><span id="PDay"></span>日&nbsp;&nbsp;&nbsp;&nbsp;(星期<span id="PWeek"></span>)</h4>
									</div>
									<div class="btn-group" style="float:right;">
		                                <div class="col-sm-10" id="selfDate" style="width:auto;">
		                                    <div class="col-sm-2" style="width:300px;">
		                                        <div class="input-group">
		                                            <span class="input-group-addon">
		                                                <i class="fa fa-calendar bigger-110"></i>
		                                            </span>
		                                            <input class="form-control" type="text" name="date-range-picker" id="id-date-range-picker-1" />
		                                        </div>
		                                    </div>
		                                </div>
		                            </div>
									<div class="hr hr-12 hr-double"></div>
									<div class="row">
										<div class="col-sm-3">
											<button class="btn btn-success" onclick="chu(this);">出勤</button>
										</div>
										<div class="col-sm-3">
											<button class="btn btn-warning" onclick="xiu(this);">休息日</button>
										</div>
										<div class="col-sm-3">
											<button class="btn btn-warning" onclick="xiao(this);">销售公休假</button>
										</div>
										<div class="col-sm-3">
											<button class="btn btn-primary" onclick="Attendance(this);">不在岗</button>
										</div>
										<input type="hidden" id="DEPTrID">
										<input type="hidden" id="DEPTdVal">
										<input type="hidden" id="DEPTrVal">
									</div>
									<div class="row" id="AttendanceText">
										<div class="hr hr-solid hr18"></div>
										<div class="row text-center" style="font-size:20px;color:#a0a0a0;padding:6px 0 15px 0;">
											请选该人员当日考勤，考勤修改后系统将自动保存
										</div>
									</div>
									<div class="row hide" id="AttendanceHoliday">
										<div class="hr hr-solid hr18"></div>
										<div class="row">
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="事">事假</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="病">病假</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="婚">婚假</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="产">产假</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="陪">陪护假</button></div>
										</div>
										<div class="row" style="padding:12px 0 6px 0;">
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="伤">工伤假</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="丧">丧假</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="旷">旷工</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="未">未到岗</button></div>
											<div class="ColSm2"><button class="btn btn-info" onclick="buzai(this);" value="离">离职</button></div>
										</div>
									</div>
								</div>

								<div class="hide" id="RecordData">
									
								</div>
								
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content-area -->
				</div><!-- /.page-content -->
			</div><!-- /.main-content -->
			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->
		
		
		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script type="text/javascript">
			window.jQuery || document.write("<script src='./assets/js/jquery.min.js'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='./assets/js/jquery1x.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='./assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="./assets/js/bootstrap.min.js"></script>

		<!-- page specific plugin scripts -->

		<!--[if lte IE 8]>
		  <script src="./assets/js/excanvas.min.js"></script>
		<![endif]-->
		<script src="./assets/js/jquery-ui.custom.min.js"></script>
		<script src="./assets/js/jquery.ui.touch-punch.min.js"></script>
		<script src="./assets/js/chosen.jquery.min.js"></script>
		<script src="./assets/js/fuelux/fuelux.spinner.min.js"></script>
		<script src="./assets/js/date-time/bootstrap-datepicker.min.js"></script>
		<script src="./assets/js/date-time/bootstrap-timepicker.min.js"></script>
		<script src="./assets/js/date-time/moment.min.js"></script>
		<script src="./assets/js/date-time/daterangepicker.min.js"></script>
		<script src="./assets/js/date-time/bootstrap-datetimepicker.min.js"></script>
		<script src="./assets/js/bootstrap-colorpicker.min.js"></script>
		<script src="./assets/js/jquery.knob.min.js"></script>
		<script src="./assets/js/jquery.autosize.min.js"></script>
		<script src="./assets/js/jquery.inputlimiter.1.3.1.min.js"></script>
		<script src="./assets/js/jquery.maskedinput.min.js"></script>
		<script src="./assets/js/bootstrap-tag.min.js"></script>
		<script src="./assets/js/typeahead.jquery.min.js"></script>
		<script src="./assets/js/dropzone.min.js"></script>
		<!-- ace scripts -->
		<script src="./assets/js/ace-elements.min.js"></script>
		<script src="./assets/js/ace.min.js"></script>

		<!-- inline scripts related to this page -->
		<!-- the following scripts are used in demo only for onpage help and you don't need them -->
		<link rel="stylesheet" href="./assets/css/ace.onpage-help.css" />
		<link rel="stylesheet" href="./docs/assets/js/themes/sunburst.css" />
		
		<script type="text/javascript"> ace.vars['base'] = '..'; </script>
		<script src="./assets/js/ace/elements.onpage-help.js"></script>
		<script src="./assets/js/ace/ace.onpage-help.js"></script>
		<script src="./docs/assets/js/rainbow.js"></script>
		<script src="./docs/assets/js/language/generic.js"></script>
		<script src="./docs/assets/js/language/html.js"></script>
		<script src="./docs/assets/js/language/css.js"></script>
		<script src="./docs/assets/js/language/javascript.js"></script>
		<script src="./assets/js/jquery.gritter.min.js"></script>
		<script src="./assets/js/fuelux/fuelux.spinner.min.js"></script>
		<script src="./assets/js/spin.min.js"></script>
		<script type="text/javascript">
			function CloseGritter(obj){
				$(obj).parents(".gritter-item-wrapper").fadeOut(function(){
					$(obj).parents(".gritter-item-wrapper").remove();
				});
			}
			//考勤填报时间数据请求
			function CheckTime(EachTime,pernrBase){
				var paramJSon = {
					"IS_PUBLIC":{
						"FLOWNO":'',
						"PERNR":'',
						"ZDOMAIN":'100',
						"I_PAGENO":'',
						"I_PAGESIZE":''
					},
					"P_DATE":EachTime,
					"P_PERNR":pernrBase
				}
				var rtnJSON = "";
				$.post("/zhrws/ZHRWS_GET_KQDATE",JSON.stringify(paramJSon),function(persTimeData){
					rtnJSON = persTimeData;
				})
				return rtnJSON;
			};
			//检查考勤填报时间
			function TimeFall(YY,MM,DD,EachTime){
				var CTJson = CheckTime(EachTime,localStorage.pernrBase?localStorage.pernrBase:'');
				var ATime = "";
				var AttendanceTime = "";
				var TimeData = "";
				//alert(CTJson.ES_PUBLIC.TYPE);
				if( CTJson.ES_PUBLIC.TYPE == '0' ){
					AttendanceTime = CTJson.P_KQYF;
					TimeData = 0;//落在范围时间内
					localStorage.removeItem("TimeData");
					localStorage.TimeData = JSON.stringify(TimeData);
				}else if( CTJson.ES_PUBLIC.TYPE == '4' ){
					if( MM == "01" ){
						YY = YY - 1;
						MM = "12";
						ATime = ''+YY+''+MM+'';
					}else{
						MM = MM - 1;
						MM = (MM<10?'0':'') + MM;
						ATime = ''+YY+''+MM+'';
					}
					AttendanceTime = ATime;
					TimeData = 1;//落在范围时间外
					localStorage.removeItem("TimeData");
					localStorage.TimeData = JSON.stringify(TimeData);
				}
				return AttendanceTime;
			}
			//获取每个月天数
			function MonthDay(DayNum){
				$("#DayEach").children("thead").html('<tr><th rowspan="2">人员编号</th><th rowspan="2">姓名</th></tr><tr></tr>');
				for( Md=1;Md<=daysEachMon[DayNum];Md++ ){
					
					//获取当前月每天的星期
					var weekArr = ['日','一','二','三','四','五','六'];
					var date = new Date();
					date.setYear($("#EachYear").html());
					date.setMonth(DayNum);
					date.setDate(Md);
					var day = date.getDay();
					if( day == 0 || day == 6 ){
						$("#DayEach").children("thead").children("tr").eq(0).append('<th style="background:#f9d057;color:#fff;">'+Md+'</th>');
						$("#DayEach").children("thead").children("tr").eq(1).append('<th style="background:#f9d057;color:#fff;">'+weekArr[day]+'</th>');
					}else{
						$("#DayEach").children("thead").children("tr").eq(0).append('<th>'+Md+'</th>');
						$("#DayEach").children("thead").children("tr").eq(1).append('<th>'+weekArr[day]+'</th>');
					}
				}
			}
			//所需填报人员的月度考勤表数据请求
			function APersData(AttendanceTime,pernrBase){
				var paramJSon = {
					"IS_PUBLIC":{
						"FLOWNO":'',
						"PERNR":'',
						"ZDOMAIN":'100',
						"I_PAGENO":'',
						"I_PAGESIZE":''
					},
					"P_KQYF":AttendanceTime,
					"P_PERNR":pernrBase
				}
				$.post("/zhrws/ZHRWS_GET_TIMESHEET",JSON.stringify(paramJSon),function(persAtData){
					if( persAtData.ES_PUBLIC.TYPE == '0' ){
						rtnJSON = persAtData;
					}else{
						rtnJSON = persAtData;
						var unique_id = $.gritter.add({
							title: '销售人员月度考勤初始化错误',
							text: ''+persAtData.ES_PUBLIC.MESSAGE+'<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}
				})
				return rtnJSON;
			};
			//所需填报人员的月度考勤状态判断
			function AState(AStateJson){
				var AState = '';
				if( AStateJson.ES_PUBLIC.TYPE == '0' ){
					ASJ_item = AStateJson.TIMESHEET.item;
					for( var k in ASJ_item ){
						if( ASJ_item[k].ZZ_KQZT == '2' ){
							AState = 2;
						}else if( ASJ_item[k].ZZ_KQZT == '3' ){
							AState = 3;
						}else{
							AState = 0;
						}
					}
				}else{
					$("#DayEach").children("tbody").html("");
					var unique_id = $.gritter.add({
						title: '月度考勤状态错误',
						text: ''+AStateJson.ES_PUBLIC.MESSAGE+'<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
						sticky: true,
						time: '',
						class_name: 'gritter-info gritter-center'
					});
					AState = 4;
				};
				return AState;
			};
			//月度考勤页面表格拼接
			function WebJoining(PAtD_item,DayNum,RunAForm,TimeData){
				$("#DayEach").children("tbody").html("");
				$("#ArticleNum").css({"position":"fixed"});
				$("#ArticleNum").css({"bottom":"0px"});
				$("#ArticleNum").css({"top":"auto"});
				$("#ArticleNum").css({"right":"0px"});
				//alert(PAtD_item.length);
				if( PAtD_item.length <= 30 ){
					for (k = 0; k < PAtD_item.length; k++) {
						var EachDay = '';
						for (i = 1; i <= daysEachMon[DayNum]; i++) {
							var D = 'D' + i + '';
							if(checkNoChar(PAtD_item[k][D]) == ""){
								EachDay += '<td onclick=""><button class="btn btn-grey">未</button></td>'
							}else if (PAtD_item[k][D] == "出") {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-success">' + PAtD_item[k][D] + '</button></td>'
							} else if (PAtD_item[k][D] == "休") {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-warning">' + PAtD_item[k][D] + '</button></td>'
							} else if (PAtD_item[k][D] == "销") {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-warning">' + PAtD_item[k][D] + '</button></td>'
							} else {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-primary">' + PAtD_item[k][D] + '</button></td>'
							}

						}
						var DEtbodyHtml = $("#DayEach").children("tbody").html();
						var DEtbodyAddHtml = '<tr id="DayEachTbodyTr_' + k + '"><td>' + PAtD_item[k].PERNR.substring(1,8) + '</td><td>' + PAtD_item[k].NACHN + '</td>' + EachDay + '</tr>';
						var DEtbodyHtml = DEtbodyHtml + DEtbodyAddHtml;
						$("#DayEach").children("tbody").html(DEtbodyHtml);
					}
					$.gritter.add({
						title: '月度考勤加载结束提示',
						text: '当前月度考勤已经加载完成',
						class_name: 'gritter-success'
					});
					$("#ArticleNum").css({
						"position": "absolute"
					});
					$("#ArticleNum").css({
						"top": "0px"
					});
					$("#ArticleNum").css({
						"button": "auto"
					});
					$("#ArticleNum").css({
						"right": "0px"
					});
					$("#ArticleNum").children("span").eq(0).html(PAtD_item.length);
					$("#ArticleNum").children("span").eq(1).html(PAtD_item.length);
				}else{
					for (k = 0; k < 30; k++) {
						var EachDay = '';
						for (i = 1; i <= daysEachMon[DayNum]; i++) {
							var D = 'D' + i + '';
							if(checkNoChar(PAtD_item[k][D]) == ""){
								EachDay += '<td onclick=""><button class="btn btn-grey">未</button></td>'
							}else if (PAtD_item[k][D] == "出") {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-success">' + PAtD_item[k][D] + '</button></td>'
							} else if (PAtD_item[k][D] == "休") {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-warning">' + PAtD_item[k][D] + '</button></td>'
							} else if (PAtD_item[k][D] == "销") {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-warning">' + PAtD_item[k][D] + '</button></td>'
							} else {
								EachDay += '<td onclick="DayTdP(this,'+RunAForm+','+TimeData+');"><button class="btn btn-primary">' + PAtD_item[k][D] + '</button></td>'
							}

						}
						var DEtbodyHtml = $("#DayEach").children("tbody").html();
						var DEtbodyAddHtml = '<tr id="DayEachTbodyTr_' + k + '"><td>' + PAtD_item[k].PERNR.substring(1,8) + '</td><td>' + PAtD_item[k].NACHN + '</td>' + EachDay + '</tr>';
						var DEtbodyHtml = DEtbodyHtml + DEtbodyAddHtml;
						$("#DayEach").children("tbody").html(DEtbodyHtml);
					}
					$("#ArticleNum").children("span").eq(0).html("30");
					$("#ArticleNum").children("span").eq(1).html(PAtD_item.length);

					var winH = $(window).height(); //页面可视区域高度 
				    var maxnum = PAtD_item.length; //设置加载最多次数
				    var num = 30;				   //初始化条数
					$(window).scroll(function() {
						var pageH = $(document.body).height();
						var PAtD_item = JSON.parse(localStorage["PAtD_item"]);
						var DayNum = localStorage["DayNum"];
						var RunAForm = localStorage["RunAForm"];
						var scrollT = $(window).scrollTop(); //滚动条top 
						var aa = (pageH - winH - scrollT) / winH;
						if (aa < 0.15 && num < maxnum) {
							for (j = 0; j < 5; j++) { //滚动时每次插入5条数据
								if (num < maxnum) {
									var EachDay = '';
									for (i = 1; i <= daysEachMon[DayNum]; i++) {
										D = 'D' + i + ''
										if(checkNoChar(PAtD_item[num][D]) == ""){
											EachDay += '<td onclick=""><button class="btn btn-grey">未</button></td>'
										}else if (PAtD_item[num][D] == "出") {
											EachDay += '<td onclick="DayTdP(this,' + RunAForm + ','+TimeData+');"><button class="btn btn-success">' + PAtD_item[num][D] + '</button></td>'
										} else if (PAtD_item[num][D] == "休") {
											EachDay += '<td onclick="DayTdP(this,' + RunAForm + ','+TimeData+');"><button class="btn btn-warning">' + PAtD_item[num][D] + '</button></td>'
										} else if (PAtD_item[num][D] == "销") {
											EachDay += '<td onclick="DayTdP(this,' + RunAForm + ','+TimeData+');"><button class="btn btn-warning">' + PAtD_item[num][D] + '</button></td>'
										} else {
											EachDay += '<td onclick="DayTdP(this,' + RunAForm + ','+TimeData+');"><button class="btn btn-primary">' + PAtD_item[num][D] + '</button></td>'
										}
									}
									var DEtbodyHtml = $("#DayEach").children("tbody").html();
									var DEtbodyAddHtml = '<tr id="DayEachTbodyTr_' + num + '"><td>' + PAtD_item[num].PERNR.substring(1, 8) + '</td><td>' + PAtD_item[num].NACHN + '</td>' + EachDay + '</tr>';
									var DEtbodyHtml = DEtbodyHtml + DEtbodyAddHtml;
									$("#DayEach").children("tbody").html(DEtbodyHtml);
									num = num + 1;
									$("#ArticleNum").children("span").eq(0).html(num);
									$("#ArticleNum").children("span").eq(1).html(PAtD_item.length);
								} else {
									$.gritter.add({
										title: '月度考勤加载结束提示',
										text: '当前月度考勤已经加载完成',
										class_name: 'gritter-success'
									});
									num = PAtD_item.length;
									$("#ArticleNum").css({
										"position": "absolute"
									});
									$("#ArticleNum").css({
										"top": "0px"
									});
									$("#ArticleNum").css({
										"button": "auto"
									});
									$("#ArticleNum").css({
										"right": "0px"
									});
									return false;
								}
							}
						}
					})
				}
					
				// var range = 100; //距下边界长度/单位px  
				// var maxnum = PAtD_item.length; //设置加载最多次数
				// var num = 30;
				// //console.log(num);
				// var totalheight = 0;
				// var main = $("#content"); //主体元素
				// if( num < maxnum ){
				// 	$(window).scroll(function() {
				// 		var PAtD_item = JSON.parse(localStorage["PAtD_item"]);
				// 		var DayNum = localStorage["DayNum"];
				// 		var RunAForm = localStorage["RunAForm"];
				// 		var srollPos = $(window).scrollTop(); //滚动条距顶部距离(页面超出窗口的高度)  
				// 		totalheight = parseFloat($(window).height()) + parseFloat(srollPos);
				// 		if (($(document).height() - range) <= totalheight && num < maxnum) {
				// 			for (j = 0; j < 5; j++) { //滚动时每次插入5条数据
				// 				if( num < maxnum ){
				// 					var EachDay = '';
				// 					for (i = 1; i <= daysEachMon[DayNum]; i++) {
				// 						D = 'D' + i + ''
				// 						if (PAtD_item[num][D] == "出") {
				// 							EachDay += '<td onclick="DayTdP(this,' + RunAForm + ');"><button class="btn btn-success">' + PAtD_item[num][D] + '</button></td>'
				// 						} else if (PAtD_item[num][D] == "休") {
				// 							EachDay += '<td onclick="DayTdP(this,' + RunAForm + ');"><button class="btn btn-warning">' + PAtD_item[num][D] + '</button></td>'
				// 						} else if (PAtD_item[num][D] == "销") {
				// 							EachDay += '<td onclick="DayTdP(this,' + RunAForm + ');"><button class="btn btn-warning">' + PAtD_item[num][D] + '</button></td>'
				// 						} else {
				// 							EachDay += '<td onclick="DayTdP(this,' + RunAForm + ');"><button class="btn btn-primary">' + PAtD_item[num][D] + '</button></td>'
				// 						}
				// 					}
				// 					var DEtbodyHtml = $("#DayEach").children("tbody").html();
				// 					var DEtbodyAddHtml = '<tr id="DayEachTbodyTr_' + num + '"><td>' + PAtD_item[k].PERNR.substring(1,8) + '</td><td>' + PAtD_item[num].NACHN + '</td>' + EachDay + '</tr>';
				// 					var DEtbodyHtml = DEtbodyHtml + DEtbodyAddHtml;
				// 					$("#DayEach").children("tbody").html(DEtbodyHtml);
				// 					num = num + 1;
				// 					$("#ArticleNum").children("span").eq(0).html(num);
				// 					$("#ArticleNum").children("span").eq(1).html(PAtD_item.length);
				// 				}else{
				// 					$.gritter.add({
				// 						title: '月度考勤加载结束提示',
				// 						text: '当前月度考勤已经加载完成',
				// 						class_name: 'gritter-success'
				// 					});
				// 					num = PAtD_item.length;
				// 					$("#ArticleNum").css({"position":"absolute"});
				// 					$("#ArticleNum").css({"top":"0px"});
				// 					$("#ArticleNum").css({"button":"auto"});
				// 					$("#ArticleNum").css({"right":"0px"});
				// 					return false;
				// 				}
				// 			}
				// 		}else{
				// 			return false;
				// 		}
				// 	})
				// }
			}
			//月份切换-上一个月
			function MonthR(EachMonth,EachYear){
				var opts = {            
		            lines: 10, // 花瓣数目
		            length: 0, // 花瓣长度
		            width: 10, // 花瓣宽度
		            radius: 20, // 花瓣距中心半径
		            corners: 1, // 花瓣圆滑度 (0-1)
		            rotate: 0, // 花瓣旋转角度
		            direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
		            color: '#2679b5', // 花瓣颜色
		            speed: 1, // 花瓣旋转速度
		            trail: 60, // 花瓣旋转时的拖影(百分比)
		            shadow: false, // 花瓣是否显示阴影
		            hwaccel: false, //spinner 是否启用硬件加速及高速旋转            
		            className: 'spinner', // spinner css 样式名称
		            zIndex: 2e9, // spinner的z轴 (默认是2000000000)
		            top: '-100', // spinner 相对父容器Top定位 单位 px
		            left: '-30'// spinner 相对父容器Left定位 单位 px
		        };
		        var target = document.getElementById("Loading");  
		        var spinner = new Spinner(opts).spin(target);
				pagei = $.layer({
					type: 1,   //0-4的选择,
					title: false,
					border: [0],
					closeBtn: [0],
					shadeClose: false,
					area: ['auto', 'auto'],
					page: {dom : '#Loading'}
				});
				setTimeout(function() {
					EachMonth = EachMonth-1;
					if( EachMonth == 0 ){
						EachMonth = 12;
						EachYear = EachYear - 1;
					}else{
						if( EachMonth < 10 ){
							EachMonth = '0'+EachMonth+''
						}
					}
					$("#EachYear").html(EachYear);
					$("#EachMonth").html(EachMonth);
					EachTime = ''+EachYear+''+EachMonth+'';
					//判断当前考勤时间与最后考勤时间(下一个月按钮显示)
					var AtdTime = localStorage["AtdTime"];
					if( parseInt(EachYear) < parseInt(AtdTime.substring(0,4)) ){
						$("#NextMonthBox").html('<span class="fc-button fc-button-next" style="float:left;" onclick="nextMonth()"><span class="fc-icon fc-icon-right-single-arrow"></span></span>');
					}else if( parseInt(EachYear) == parseInt(AtdTime.substring(0,4)) ){
						if( parseInt(EachMonth) < parseInt(AtdTime.substring(4,6)) ){
							$("#NextMonthBox").html('<span class="fc-button fc-button-next" style="float:left;" onclick="nextMonth()"><span class="fc-icon fc-icon-right-single-arrow"></span></span>');
						}
					}
					//检查考勤填报时间
					var AttendanceTime = EachTime;
					var NTimeData = 1;
					//获取每个月天数
					var DayNum = AttendanceTime.substring(4,6) - 1;
					MonthDay(DayNum);
					//所需填报人员的月度考勤表数据请求
					var AStateJson = APersData(AttendanceTime,localStorage.pernrBase?localStorage.pernrBase:'');
					//加载所需填报人员的月度考勤表
					var RunAForm = AState(AStateJson);
					if( NTimeData == 0 ){						//填报时间内
						if( RunAForm == "4" ){
							$("#DayEach").children("tbody").html("");
							$("#ASubmitBtn").addClass("disabled");
							$("#ASubmitBtn").addClass("hide");
						}else{
							if( RunAForm == "2" ){
								$("#ASubmitBtn").addClass("disabled");
								$("#ASubmitBtn").addClass("hide");
							}else{
								$("#ASubmitBtn").removeClass("disabled");
								$("#ASubmitBtn").removeClass("hide");
							}
							var PAtD_item = AStateJson.TIMESHEET.item;
							localStorage.removeItem("PAtD_item");
							localStorage.PAtD_item = JSON.stringify(PAtD_item);
							localStorage.removeItem("PAtD_item_Submit");
							localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item);
							localStorage.removeItem("RunAForm");
							localStorage.RunAForm = RunAForm;
							localStorage.DayNum = DayNum;
							WebJoining(PAtD_item,DayNum,RunAForm,NTimeData);
						}
					}else{										//填报时间外
						if( RunAForm == "4" ){
							$("#DayEach").children("tbody").html("");
							$("#ASubmitBtn").addClass("disabled");
							$("#ASubmitBtn").addClass("hide");
						}else{
							if( RunAForm == "3" ){
								$("#ASubmitBtn").removeClass("disabled");
								$("#ASubmitBtn").removeClass("hide");
							}else{
								$("#ASubmitBtn").addClass("disabled");
								$("#ASubmitBtn").addClass("hide");
							}
							var PAtD_item = AStateJson.TIMESHEET.item;
							localStorage.removeItem("PAtD_item");
							localStorage.PAtD_item = JSON.stringify(PAtD_item);
							localStorage.removeItem("PAtD_item_Submit");
							localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item);
							localStorage.removeItem("RunAForm");
							localStorage.RunAForm = RunAForm;
							localStorage.DayNum = DayNum;
							WebJoining(PAtD_item,DayNum,RunAForm,NTimeData);
						}
					}
					spinner.spin();
					layer.close(pagei);
				}, 300 + parseInt(Math.random() * 300));
			}
			function lastMonth(){
				var thisYear = new Date().getFullYear();
				var lastMonth = new Date().getMonth();
				var thisMonth = new Date().getMonth() + 1;
				var Constant = localStorage["Constant"];
				var EachYear = $("#EachYear").html();
				var EachMonth = $("#EachMonth").html();
				$("#RecordData").html("");
				if( Constant == "03" ){
					if( EachMonth == "12" ){
						var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}else{
						MonthR(EachMonth,EachYear)
					}
				}else if( Constant == "02" ){
					if( EachMonth == "11" ){
						var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}else{
						MonthR(EachMonth,EachYear)
					}
				}else if( Constant == "01" ){
					if( EachMonth == "10" ){
						var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}else{
						MonthR(EachMonth,EachYear)
					}
				}else if( Constant - EachMonth < 3 ){
					MonthR(EachMonth,EachYear)
				}else{
					var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
				}
			}
			//月份切换-下一个月
			function MonthA(EachMonth,EachYear,YYNext,MMNext,DDNext,EachTimeNext){
				var opts = {            
		            lines: 10, // 花瓣数目
		            length: 0, // 花瓣长度
		            width: 10, // 花瓣宽度
		            radius: 20, // 花瓣距中心半径
		            corners: 1, // 花瓣圆滑度 (0-1)
		            rotate: 0, // 花瓣旋转角度
		            direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
		            color: '#2679b5', // 花瓣颜色
		            speed: 1, // 花瓣旋转速度
		            trail: 60, // 花瓣旋转时的拖影(百分比)
		            shadow: false, // 花瓣是否显示阴影
		            hwaccel: false, //spinner 是否启用硬件加速及高速旋转            
		            className: 'spinner', // spinner css 样式名称
		            zIndex: 2e9, // spinner的z轴 (默认是2000000000)
		            top: '-100', // spinner 相对父容器Top定位 单位 px
		            left: '-30'// spinner 相对父容器Left定位 单位 px
		        };
		        var target = document.getElementById("Loading");  
		        var spinner = new Spinner(opts).spin(target);
				pagei = $.layer({
					type: 1,   //0-4的选择,
					title: false,
					border: [0],
					closeBtn: [0],
					shadeClose: false,
					area: ['auto', 'auto'],
					page: {dom : '#Loading'}
				});
				setTimeout(function() {
					if( EachMonth == 12 ){
						EachMonth = 00;
						EachYear = parseInt(EachYear) + 1;
					}
					EachMonth = parseInt(EachMonth)+1;
					if( EachMonth < 10 ){
						EachMonth = '0'+EachMonth+''
					}
					$("#EachYear").html(EachYear);
					$("#EachMonth").html(EachMonth);

					EachTime = ''+EachYear+''+EachMonth+'';
					//判断当前考勤时间与最后考勤时间(下一个月按钮显示)
					var AtdTime = localStorage["AtdTime"];
					if( parseInt(EachYear) == parseInt(AtdTime.substring(0,4)) ){
						if( parseInt(EachMonth) == parseInt(AtdTime.substring(4,6)) ){
							$("#NextMonthBox").html('<span class="fc-button fc-button-next" style="float:left;background:#ccc;" onclick=""><span class="fc-icon fc-icon-right-single-arrow"></span></span>');
						}
					}
					//检查考勤填报时间
					var AttendanceTime = EachTime;
					
					var AttendanceTimeNext = TimeFall(YYNext,MMNext,DDNext,EachTimeNext);
					var TimeDataNext = JSON.parse(localStorage["TimeData"]);
					//alert(TimeDataNext);
					var NTimeData = 1;
					//获取每个月天数
					var DayNum = AttendanceTime.substring(4,6) - 1;
					MonthDay(DayNum);
					//所需填报人员的月度考勤表数据请求
					var AStateJson = APersData(AttendanceTime,localStorage.pernrBase?localStorage.pernrBase:'');
					//加载所需填报人员的月度考勤表
					var RunAForm = AState(AStateJson);
					if( NTimeData == 0 ){						//填报时间内
						if( RunAForm == "4" ){
							$("#DayEach").children("tbody").html("");
							$("#ASubmitBtn").addClass("disabled");
							$("#ASubmitBtn").addClass("hide");
						}else{
							if( RunAForm == "2" ){
								$("#ASubmitBtn").addClass("disabled");
								$("#ASubmitBtn").addClass("hide");
							}else{
								$("#ASubmitBtn").removeClass("disabled");
								$("#ASubmitBtn").removeClass("hide");
							}
							var PAtD_item = AStateJson.TIMESHEET.item;
							localStorage.removeItem("PAtD_item");
							localStorage.PAtD_item = JSON.stringify(PAtD_item);
							localStorage.removeItem("PAtD_item_Submit");
							localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item);
							localStorage.removeItem("RunAForm");
							localStorage.RunAForm = RunAForm;
							localStorage.DayNum = DayNum;
							WebJoining(PAtD_item,DayNum,RunAForm,NTimeData);
						}
					}else{										//填报时间外
						if( RunAForm == "4" ){
							$("#DayEach").children("tbody").html("");
							$("#ASubmitBtn").addClass("disabled");
							$("#ASubmitBtn").addClass("hide");
						}else{
							if( RunAForm == "3" ){
								$("#ASubmitBtn").removeClass("disabled");
								$("#ASubmitBtn").removeClass("hide");
							}else{
								$("#ASubmitBtn").addClass("disabled");
								$("#ASubmitBtn").addClass("hide");
							}
							var PAtD_item = AStateJson.TIMESHEET.item;
							localStorage.removeItem("PAtD_item");
							localStorage.PAtD_item = JSON.stringify(PAtD_item);
							localStorage.removeItem("PAtD_item_Submit");
							localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item);
							localStorage.removeItem("RunAForm");
							localStorage.RunAForm = RunAForm;
							localStorage.DayNum = DayNum;
							WebJoining(PAtD_item,DayNum,RunAForm,NTimeData);
						}
					}
					spinner.spin();
					layer.close(pagei);
				}, 300 + parseInt(Math.random() * 300));
			}
			function nextMonth(){
				var thisYear = new Date().getFullYear();
				var lastMonth = new Date().getMonth();
				var thisMonth = new Date().getMonth() + 1;
				var thisDay = new Date().getDate();
				var YYNext = thisYear;
				var MMNext = (thisMonth<10?'0':'') + thisMonth;
				var DDNext = (thisDay<10?'0':'') + thisDay;
				var EachTimeNext =  YYNext + MMNext + DDNext;


				var Constant = localStorage["Constant"];
				var EachYear = $("#EachYear").html();
				var EachMonth = $("#EachMonth").html();
				$("#RecordData").html("");

				var AtdTime = localStorage["AtdTime"];
				var AtdTimeLast = parseInt(AtdTime.substring(4,6)) + 1;
				//alert(lastMonth);
				//return;
				if( EachYear == AtdTime.substring(0,4) && EachMonth == AtdTime.substring(4,6) ){
					var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: ''+AtdTimeLast+'月的考勤尚未生成,暂时不能查看<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
				}else if( Constant == "10" ){
					if( EachMonth == "01" ){
						var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}else{
						MonthA(EachMonth,EachYear,YYNext,MMNext,DDNext,EachTimeNext)
					}
				}else if( Constant == "11" ){
					if( EachMonth == "02" ){
						var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}else{
						MonthA(EachMonth,EachYear,YYNext,MMNext,DDNext,EachTimeNext)
					}
				}else if( Constant == "12" ){
					if( EachMonth == "03" ){
						var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}else{
						MonthA(EachMonth,EachYear,YYNext,MMNext,DDNext,EachTimeNext)
					}
				}else if( EachMonth - Constant < 3 ){
					MonthA(EachMonth,EachYear,YYNext,MMNext,DDNext,EachTimeNext)
				}else{
					var unique_id = $.gritter.add({
							title: '月度考勤时间错误',
							text: '您只能查询3个月内的考勤表数据<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
				}
			}
			//考勤修改点击事件
			function DayTdP(obj,RunAForm,TimeData){
				//alert(RunAForm);
				//var TimeData = '2';
				if( RunAForm == "0" ){
					if( TimeData == 1 ){
						$.gritter.add({
							title: '月度考勤报表提交错误',
							text: '当前时间不在月度考勤填报时间内',
							class_name: 'gritter-info'
						});
					}else{
						var g = $(obj).parent("tr").attr("id");
						var k = $(obj).index();
						var j = $(obj).parent("tr").index();
						localStorage.removeItem("g");
						localStorage.g = JSON.stringify(g);
						localStorage.removeItem("k");
						localStorage.k = JSON.stringify(k);
						localStorage.removeItem("j");
						localStorage.j = JSON.stringify(j);
						var DayTdPName = $(obj).parent("tr").children("td").eq(1).html();
						var DayTdPPernr = $(obj).parent("tr").children("td").eq(0).html();

						var PYear = $("#EachYear").html();
						var PMonth = $("#EachMonth").html();
						var PWeek = $("#DayEach").children("thead").children("tr").eq(1).children("th").eq(k-2).html();
						localStorage.removeItem("PYear");
						localStorage.PYear = JSON.stringify(PYear);
						localStorage.removeItem("PMonth");
						localStorage.PMonth = JSON.stringify(PMonth);
						localStorage.removeItem("PWeek");
						localStorage.PWeek = JSON.stringify(PWeek);

						// pagei = $.layer({
							// 	type: 1,   //0-4的选择,
							// 	title: '<h4 class="smaller"><i class="ace-icon fa fa-check"></i><span>'+DayTdPName+'&nbsp;&nbsp;&nbsp;&nbsp;'+DayTdPPernr+'<span></h4>',
							// 	border: [0],
							// 	shadeClose: true,
							// 	area: ['560px', 'auto'],
							// 	page: {dom : '#DayEachPlay'}
						// });
						pagei = $.layer({
						    type: 2,
						    title: '<h4 class="smaller"><i class="ace-icon fa fa-check"></i><span>'+DayTdPName+'&nbsp;&nbsp;&nbsp;&nbsp;'+DayTdPPernr+'<span></h4>',
							shadeClose: true,
							
							area: ['700px', '480px'],
							iframe: {src : 'DayEach_PopPpage.html'},
						});
						$(".xubox_main").css({"height":"230px"});
						// $("#AttendanceText").removeClass("hide");
						// $("#AttendanceHoliday").addClass("hide");
					}
				}else if( RunAForm == '2' ){
					$.gritter.add({
						title: '月度考勤报表提交错误',
						text: '当前的考勤报表已提交过，无法再次提交',
						class_name: 'gritter-info'
					});
				}else if( RunAForm == "3" ){
					var g = $(obj).parent("tr").attr("id");
					var k = $(obj).index();
					var j = $(obj).parent("tr").index();
					$("#DEPTrID").val(g);
					$("#DEPTdVal").val(k);
					$("#DEPTrVal").val(j);
					var DayTdPName = $(obj).parent("tr").children("td").eq(1).html();
					var DayTdPPernr = $(obj).parent("tr").children("td").eq(0).html();
					$("#PYearMonth").html($("#EachYear").html()+"年"+$("#EachMonth").html()+"月");
					$("#PDay").html(k-1);
					$("#PWeek").html($("#DayEach").children("thead").children("tr").eq(1).children("th").eq(k-2).html());
					pagei = $.layer({
						type: 1,   //0-4的选择,
						title: '<h4 class="smaller"><i class="ace-icon fa fa-check"></i><span>'+DayTdPName+'&nbsp;&nbsp;&nbsp;&nbsp;'+DayTdPPernr+'<span></h4>',
						border: [0],
						shadeClose: true,
						area: ['560px', 'auto'],
						page: {dom : '#DayEachPlay'}
					});
					$(".xubox_main").css({"height":"230px"});
					$("#AttendanceText").removeClass("hide");
					$("#AttendanceHoliday").addClass("hide");
				}
			};
			//出勤
			function chu(g,k,j,StartDate,EndDate){
				var opts = {            
		            lines: 10, // 花瓣数目
		            length: 0, // 花瓣长度
		            width: 10, // 花瓣宽度
		            radius: 20, // 花瓣距中心半径
		            corners: 1, // 花瓣圆滑度 (0-1)
		            rotate: 0, // 花瓣旋转角度
		            direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
		            color: '#2679b5', // 花瓣颜色
		            speed: 1, // 花瓣旋转速度
		            trail: 60, // 花瓣旋转时的拖影(百分比)
		            shadow: false, // 花瓣是否显示阴影
		            hwaccel: false, //spinner 是否启用硬件加速及高速旋转            
		            className: 'spinner', // spinner css 样式名称
		            zIndex: 2e9, // spinner的z轴 (默认是2000000000)
		            top: '-100', // spinner 相对父容器Top定位 单位 px
		            left: '-30'// spinner 相对父容器Left定位 单位 px
		        };
		        var target = document.getElementById("Loading");  
		        var spinner = new Spinner(opts).spin(target);
				donghua = $.layer({
					type: 1,   //0-4的选择,
					title: false,
					border: [0],
					closeBtn: [0],
					shadeClose: false,
					area: ['auto', 'auto'],
					page: {dom : '#Loading'}
				});
				setTimeout(function() {
					var StartNum = parseInt(StartDate.substring(8,10));
					var EndNum = parseInt(EndDate.substring(8,10));
					for( f=0;f<=EndNum-StartNum;f++ ){
						var WeiK = Number(k)+Number(f);
						$('#'+g+'').children("td").eq(WeiK).children("button").html("出");
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-warning");
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-primary");
						$('#'+g+'').children("td").eq(WeiK).children("button").addClass("btn-success");
						RecordData(j,WeiK);
						Temporary();
						
						//判断临时保存是否失败，如果失败则终止循环
						var LinShiType = JSON.parse(localStorage["LinShiType"]);
						if( LinShiType != '0' ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
							$.gritter.add({
								title: '月度考勤报表临时保存提示',
								text: ''+MESSAGE+'',
								class_name: 'gritter-error'
							});
							return false;
						}
						//判断临时保存是否成功，如果成功则给出最后一次提示
						if( f == EndNum-StartNum ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							if( LinShiType == '0' ){
								var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
								$.gritter.add({
									title: '月度考勤报表临时保存提示',
									text: ''+StartDate+'~'+EndDate+''+MESSAGE+'',
									class_name: 'gritter-success'
								});
							}
							return false;
						}
					}
				}, 300 + parseInt(Math.random() * 300));
			};
			//休假
			function xiu(g,k,j,StartDate,EndDate){
				var opts = {            
		            lines: 10, // 花瓣数目
		            length: 0, // 花瓣长度
		            width: 10, // 花瓣宽度
		            radius: 20, // 花瓣距中心半径
		            corners: 1, // 花瓣圆滑度 (0-1)
		            rotate: 0, // 花瓣旋转角度
		            direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
		            color: '#2679b5', // 花瓣颜色
		            speed: 1, // 花瓣旋转速度
		            trail: 60, // 花瓣旋转时的拖影(百分比)
		            shadow: false, // 花瓣是否显示阴影
		            hwaccel: false, //spinner 是否启用硬件加速及高速旋转            
		            className: 'spinner', // spinner css 样式名称
		            zIndex: 2e9, // spinner的z轴 (默认是2000000000)
		            top: '-100', // spinner 相对父容器Top定位 单位 px
		            left: '-30'// spinner 相对父容器Left定位 单位 px
		        };
		        var target = document.getElementById("Loading");  
		        var spinner = new Spinner(opts).spin(target);
				donghua = $.layer({
					type: 1,   //0-4的选择,
					title: false,
					border: [0],
					closeBtn: [0],
					shadeClose: false,
					area: ['auto', 'auto'],
					page: {dom : '#Loading'}
				});
				setTimeout(function() {
					var StartNum = parseInt(StartDate.substring(8,10));
					var EndNum = parseInt(EndDate.substring(8,10));
					for( f=0;f<=EndNum-StartNum;f++ ){
						var WeiK = Number(k)+Number(f);
						$('#'+g+'').children("td").eq(WeiK).children("button").html("休");
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-success");
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-primary");
						$('#'+g+'').children("td").eq(WeiK).children("button").addClass("btn-warning");
						RecordData(j,WeiK);
						Temporary();

						//判断临时保存是否失败，如果失败则终止循环
						var LinShiType = JSON.parse(localStorage["LinShiType"]);
						if( LinShiType != '0' ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
							$.gritter.add({
								title: '月度考勤报表临时保存提示',
								text: ''+MESSAGE+'',
								class_name: 'gritter-error'
							});
							return false;
						}
						//判断临时保存是否成功，如果成功则给出最后一次提示
						if( f == EndNum-StartNum ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							if( LinShiType == '0' ){
								var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
								$.gritter.add({
									title: '月度考勤报表临时保存提示',
									text: ''+StartDate+'~'+EndDate+''+MESSAGE+'',
									class_name: 'gritter-success'
								});
							}
							return false;
						}
					}
				}, 300 + parseInt(Math.random() * 300));
			};
			//销售公休假
			function xiao(g,k,j,StartDate,EndDate){
				var opts = {            
		            lines: 10, // 花瓣数目
		            length: 0, // 花瓣长度
		            width: 10, // 花瓣宽度
		            radius: 20, // 花瓣距中心半径
		            corners: 1, // 花瓣圆滑度 (0-1)
		            rotate: 0, // 花瓣旋转角度
		            direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
		            color: '#2679b5', // 花瓣颜色
		            speed: 1, // 花瓣旋转速度
		            trail: 60, // 花瓣旋转时的拖影(百分比)
		            shadow: false, // 花瓣是否显示阴影
		            hwaccel: false, //spinner 是否启用硬件加速及高速旋转            
		            className: 'spinner', // spinner css 样式名称
		            zIndex: 2e9, // spinner的z轴 (默认是2000000000)
		            top: '-100', // spinner 相对父容器Top定位 单位 px
		            left: '-30'// spinner 相对父容器Left定位 单位 px
		        };
		        var target = document.getElementById("Loading");  
		        var spinner = new Spinner(opts).spin(target);
				donghua = $.layer({
					type: 1,   //0-4的选择,
					title: false,
					border: [0],
					closeBtn: [0],
					shadeClose: false,
					area: ['auto', 'auto'],
					page: {dom : '#Loading'}
				});
				setTimeout(function() {
					var StartNum = parseInt(StartDate.substring(8,10));
					var EndNum = parseInt(EndDate.substring(8,10));
					for( f=0;f<=EndNum-StartNum;f++ ){
						var WeiK = Number(k)+Number(f);
						$('#'+g+'').children("td").eq(WeiK).children("button").html("销");
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-success");
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-primary");
						$('#'+g+'').children("td").eq(WeiK).children("button").addClass("btn-warning");
						RecordData(j,WeiK);
						Temporary();

						//判断临时保存是否失败，如果失败则终止循环
						var LinShiType = JSON.parse(localStorage["LinShiType"]);
						if( LinShiType != '0' ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
							$.gritter.add({
								title: '月度考勤报表临时保存提示',
								text: ''+MESSAGE+'',
								class_name: 'gritter-error'
							});
							return false;
						}
						//判断临时保存是否成功，如果成功则给出最后一次提示
						if( f == EndNum-StartNum ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							if( LinShiType == '0' ){
								var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
								$.gritter.add({
									title: '月度考勤报表临时保存提示',
									text: ''+StartDate+'~'+EndDate+''+MESSAGE+'',
									class_name: 'gritter-success'
								});
							}
							return false;
						}
					}
				}, 300 + parseInt(Math.random() * 300));
			};
			//不在岗
			function buzai(g,k,j,StartDate,EndDate,BZG){
				var opts = {            
		            lines: 10, // 花瓣数目
		            length: 0, // 花瓣长度
		            width: 10, // 花瓣宽度
		            radius: 20, // 花瓣距中心半径
		            corners: 1, // 花瓣圆滑度 (0-1)
		            rotate: 0, // 花瓣旋转角度
		            direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
		            color: '#2679b5', // 花瓣颜色
		            speed: 1, // 花瓣旋转速度
		            trail: 60, // 花瓣旋转时的拖影(百分比)
		            shadow: false, // 花瓣是否显示阴影
		            hwaccel: false, //spinner 是否启用硬件加速及高速旋转            
		            className: 'spinner', // spinner css 样式名称
		            zIndex: 2e9, // spinner的z轴 (默认是2000000000)
		            top: '-100', // spinner 相对父容器Top定位 单位 px
		            left: '-30'// spinner 相对父容器Left定位 单位 px
		        };
		        var target = document.getElementById("Loading");  
		        var spinner = new Spinner(opts).spin(target);
				donghua = $.layer({
					type: 1,   //0-4的选择,
					title: false,
					border: [0],
					closeBtn: [0],
					shadeClose: false,
					area: ['auto', 'auto'],
					page: {dom : '#Loading'}
				});
				setTimeout(function() {
					var StartNum = parseInt(StartDate.substring(8,10));
					var EndNum = parseInt(EndDate.substring(8,10));
					for( f=0;f<=EndNum-StartNum;f++ ){
						var WeiK = Number(StartNum+1)+Number(f);
						$('#'+g+'').children("td").eq(WeiK).children("button").html(BZG);
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-success");
						$('#'+g+'').children("td").eq(WeiK).children("button").removeClass("btn-warning");
						$('#'+g+'').children("td").eq(WeiK).children("button").addClass("btn-primary");
						RecordData(j,WeiK);
						Temporary();
						
						//判断临时保存是否失败，如果失败则终止循环
						var LinShiType = JSON.parse(localStorage["LinShiType"]);
						if( LinShiType != '0' ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
							$.gritter.add({
								title: '月度考勤报表临时保存提示',
								text: ''+MESSAGE+'',
								class_name: 'gritter-error'
							});
							return false;
						}
						//判断临时保存是否成功，如果成功则给出最后一次提示
						if( f == EndNum-StartNum ){
							layer.close(pagei);
							spinner.spin();
							layer.close(donghua);
							if( LinShiType == '0' ){
								var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
								$.gritter.add({
									title: '月度考勤报表临时保存提示',
									text: ''+StartDate+'~'+EndDate+''+MESSAGE+'',
									class_name: 'gritter-success'
								});
							}
							return false;
						}
					}
				}, 300 + parseInt(Math.random() * 300));
			};
			//记录被修改的月度考勤位置
			function RecordData(j,k){
				RDinput = '<input type="hidden" value='+j+'><input type="hidden" value='+k+'>'
				RDhtml = $("#RecordData").html();
				RDhtml = RDhtml+'<div>'+RDinput+'</div>'
				$("#RecordData").html(RDhtml);
			}
			//临时保存月度考勤表
			function Temporary(){
				var date = new Date();
				var PYear = date.getFullYear();
				var PMonth = (date.getMonth() + 1) < 10 ? ("0" + (date.getMonth() + 1)) : (date.getMonth() + 1);
				var PDay = (date.getDate()) < 10 ? ("0" + (date.getDate())) : (date.getDate());
				var PHours = (date.getHours()) < 10 ? ("0" + (date.getHours())) : (date.getHours());
				var PMinutes = (date.getMinutes()) < 10 ? ("0" + (date.getMinutes())) : (date.getMinutes());
				//var PSeconds = 00;

				var PDATE = ''+PYear+''+PMonth+''+PDay+'';
				var PTIME = ''+PHours+''+PMinutes+'00';
				var pernrBase = localStorage["pernrBase"];
				var RunAForm = localStorage["RunAForm"];
				if( RunAForm == "0" ){
					var RDlengt = $("#RecordData").find("div").length;
					for( i=0;i<RDlengt;i++ ){
						if( RDlengt == 0 ){
							var PAtD_item_Submit = JSON.parse(localStorage["PAtD_item_Submit"]);
						}else{
							X = $("#RecordData").find("div").eq(i).children("input").eq(1).val();
							Y = $("#RecordData").find("div").eq(i).children("input").eq(0).val();
							var PAtD_item_Submit = JSON.parse(localStorage["PAtD_item_Submit"]);
							var Z = X - 1;
							var Day = 'D'+Z+'';
							var APD = $('#DayEachTbodyTr_'+Y+'').children("td").eq(X).children("button").html();
							PAtD_item_Submit[Y].ZZ_KQZT = "1";
							PAtD_item_Submit[Y][Day] = APD;
						}					
					}
					var paramJSon = {
						"IS_PUBLIC":{
							"FLOWNO":'',
							"PERNR":'',
							"ZDOMAIN":'100',
							"I_PAGENO":'',
							"I_PAGESIZE":''
						},
						"P_DATE":PDATE,
						"P_KQZT":'1',
						"P_PERNR":pernrBase,
						"P_TIME":PTIME,
						"TIMESHEET":{
							"item":PAtD_item_Submit
						}
					}
					$.post("/zhrws/ZHRWS_SUBMIT_TIMESHEET",JSON.stringify(paramJSon),function(ASubmitData){
						var LinShiType = ASubmitData.ES_PUBLIC.TYPE;
						localStorage.removeItem("LinShiType");
						localStorage.LinShiType = JSON.stringify(LinShiType);
						if( ASubmitData.ES_PUBLIC.TYPE == '0' ){
							var MESSAGE = "月度考勤表保存成功";
							localStorage.removeItem("MESSAGE");
							localStorage.MESSAGE = JSON.stringify(MESSAGE);
							localStorage.removeItem("PAtD_item_Submit");
							localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item_Submit);
						}else{
							var MESSAGE = ASubmitData.ES_PUBLIC.MESSAGE;
							localStorage.removeItem("MESSAGE");
							localStorage.MESSAGE = JSON.stringify(MESSAGE);
						}
					});	
				}else if( RunAForm == "3" ){
					var RDlengt = $("#RecordData").find("div").length;
					for( i=0;i<RDlengt;i++ ){
						if( RDlengt == 0 ){
							var PAtD_item_Submit = JSON.parse(localStorage["PAtD_item_Submit"]);
						}else{
							X = $("#RecordData").find("div").eq(i).children("input").eq(1).val();
							Y = $("#RecordData").find("div").eq(i).children("input").eq(0).val();
							var PAtD_item_Submit = JSON.parse(localStorage["PAtD_item_Submit"]);
							var Z = X - 1;
							var Day = 'D'+Z+'';
							var APD = $('#DayEachTbodyTr_'+Y+'').children("td").eq(X).children("button").html();
							PAtD_item_Submit[Y][Day] = APD;
						}	
					}
					var paramJSon = {
						"IS_PUBLIC":{
							"FLOWNO":'',
							"PERNR":'',
							"ZDOMAIN":'100',
							"I_PAGENO":'',
							"I_PAGESIZE":''
						},
						"P_DATE":PDATE,
						"P_KQZT":'3',
						"P_PERNR":pernrBase,
						"P_TIME":PTIME,
						"TIMESHEET":{
							"item":PAtD_item_Submit
						}
					}
					// localStorage.removeItem("PAtD_item");
					// localStorage.PAtD_item = JSON.stringify(PAtD_item);
					$.post("/zhrws/ZHRWS_SUBMIT_TIMESHEET",JSON.stringify(paramJSon),function(ASubmitData){
						var LinShiType = ASubmitData.ES_PUBLIC.TYPE;
						localStorage.removeItem("LinShiType");
						localStorage.LinShiType = JSON.stringify(LinShiType);
						if( ASubmitData.ES_PUBLIC.TYPE == '0' ){
							var MESSAGE = "月度考勤表保存成功";
							localStorage.removeItem("MESSAGE");
							localStorage.MESSAGE = JSON.stringify(MESSAGE);
							localStorage.removeItem("PAtD_item_Submit");
							localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item_Submit);
						}else{
							var MESSAGE = ASubmitData.ES_PUBLIC.MESSAGE;
							localStorage.removeItem("MESSAGE");
							localStorage.MESSAGE = JSON.stringify(MESSAGE);
						}
					})
				}
			}
			//提交月度考勤表
			function ASubmitBtn(obj){
				var unique_id = $.gritter.add({
					title: '月度考勤报表提交提示',
					text: '考勤表提交后将不能再修改，您确定要提交吗？<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-3" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);"><i class="ace-icon glyphicon glyphicon-remove"></i>取消</button></span><span class="col-sm-3" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);Submit_Into();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
					sticky: true,
					time: '',
					class_name: 'gritter-info gritter-center'
				});
			}
			function WindowClose(){
				window.close();
			}
			//提交成功提示
			function Submit_Into(){
				var date = new Date();
				var PYear = date.getFullYear();
				var PMonth = (date.getMonth() + 1) < 10 ? ("0" + (date.getMonth() + 1)) : (date.getMonth() + 1);
				var PDay = (date.getDate()) < 10 ? ("0" + (date.getDate())) : (date.getDate());
				var PHours = (date.getHours()) < 10 ? ("0" + (date.getHours())) : (date.getHours());
				var PMinutes = (date.getMinutes()) < 10 ? ("0" + (date.getMinutes())) : (date.getMinutes());
				//var PSeconds = 00;

				var PDATE = ''+PYear+''+PMonth+''+PDay+'';
				var PTIME = ''+PHours+''+PMinutes+'00';
				var pernrBase = localStorage["pernrBase"];
				var RunAForm = localStorage["RunAForm"];
				if( RunAForm == "0" || RunAForm == "3" ){
					var RDlengt = $("#RecordData").find("div").length;
					if( RDlengt == 0 ){
						var PAtD_item_Submit = JSON.parse(localStorage["PAtD_item_Submit"]);
					}else{
						for( i=0;i<RDlengt;i++ ){
							X = $("#RecordData").find("div").eq(i).children("input").eq(1).val();
							Y = $("#RecordData").find("div").eq(i).children("input").eq(0).val();
							var PAtD_item_Submit = JSON.parse(localStorage["PAtD_item_Submit"]);
							var Z = X - 1;
							var Day = 'D'+Z+'';
							var APD = $('#DayEachTbodyTr_'+Y+'').children("td").eq(X).children("button").html();
							PAtD_item_Submit[Y][Day] = APD;
						}
					}
					var paramJSon = {
						"IS_PUBLIC":{
							"FLOWNO":'',
							"PERNR":'',
							"ZDOMAIN":'100',
							"I_PAGENO":'',
							"I_PAGESIZE":''
						},
						"P_DATE":PDATE,
						"P_KQZT":'2',
						"P_PERNR":pernrBase,
						"P_TIME":PTIME,
						"TIMESHEET":{
							"item":PAtD_item_Submit
						}
					}
					$.post("/zhrws/ZHRWS_SUBMIT_TIMESHEET",JSON.stringify(paramJSon),function(ASubmitData){
						if( ASubmitData.ES_PUBLIC.TYPE == '0' ){
							var MESSAGE = "提交成功";
							localStorage.removeItem("MESSAGE");
							localStorage.MESSAGE = JSON.stringify(MESSAGE);
							localStorage.removeItem("PAtD_item_Submit");
							localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item_Submit);
						}else{
							var MESSAGE = ASubmitData.ES_PUBLIC.MESSAGE;
							localStorage.removeItem("MESSAGE");
							localStorage.MESSAGE = JSON.stringify(MESSAGE);
						}
					})
					var MESSAGE = JSON.parse(localStorage["MESSAGE"]);
					var unique_id = $.gritter.add({
							title: '月度考勤报表提交提示',
							text: ''+MESSAGE+'<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
					});
					//window.location.reload();
				}
			}
			//页面初始化加载考勤信息
			jQuery(function($) {
				//alert(localStorage.pernrBase?localStorage.pernrBase:'');
				$('#id-date-range-picker-1').daterangepicker({
                    timePicker: true,
                    timePickerIncrement: 30,
                    format: 'YYYY-MM-DD',
                    startDate: '2015-07-31',
                    minDate: '2015-07-01',
                    maxDate: '2015-08-01'
                }, function(start, end, label) {
                    console.log(start.toISOString(), end.toISOString(), label);
                });
				
				var localCookie = document.cookie;
				var cookie_user = '';
				if(localCookie.length > 0 && localCookie.indexOf('userid')>-1){
					localCookie = localCookie.split(';');
					for(var lc in localCookie){
						if(localCookie[lc].indexOf('userid=')>-1){
							cookie_user = localCookie[lc];
							break;
						}
					} 
					if(cookie_user == ''){
						var unique_id = $.gritter.add({
							title: '系统登录错误提示',
							text: '无法获取信息，请重新登录<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
						return;
					}else{
						cookie_user = trim(cookie_user).substring(7);
						localStorage.removeItem('pernrBase');
						localStorage.setItem('pernrBase',cookie_user);
					}
				}else{
					var unique_id = $.gritter.add({
						title: '系统登录错误提示',
						text: '无法获取信息，请重新登录<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
						sticky: true,
						time: '',
						class_name: 'gritter-info gritter-center'
					});
					return;
				}
				var opts = {            
		            lines: 10, // 花瓣数目
		            length: 0, // 花瓣长度
		            width: 10, // 花瓣宽度
		            radius: 20, // 花瓣距中心半径
		            corners: 1, // 花瓣圆滑度 (0-1)
		            rotate: 0, // 花瓣旋转角度
		            direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
		            color: '#2679b5', // 花瓣颜色
		            speed: 1, // 花瓣旋转速度
		            trail: 60, // 花瓣旋转时的拖影(百分比)
		            shadow: false, // 花瓣是否显示阴影
		            hwaccel: false, //spinner 是否启用硬件加速及高速旋转            
		            className: 'spinner', // spinner css 样式名称
		            zIndex: 2e9, // spinner的z轴 (默认是2000000000)
		            top: '-100', // spinner 相对父容器Top定位 单位 px
		            left: '-30'// spinner 相对父容器Left定位 单位 px
		        };
		        var target = document.getElementById("Loading");  
		        var spinner = new Spinner(opts).spin(target);
				pagei = $.layer({
					type: 1,   //0-4的选择,
					title: false,
					border: [0],
					closeBtn: [0],
					shadeClose: false,
					area: ['auto', 'auto'],
					page: {dom : '#Loading'}
				});
				setTimeout(function() {
					//初始化数据
					var thisYear = new Date().getFullYear();
					var lastMonth = new Date().getMonth();
					var thisMonth = new Date().getMonth() + 1;
					var thisDay = new Date().getDate();
					var daysEachMon = [31,28,31,30,31,30,31,31,30,31,30,31];//每个月的天数
					daysEachMon[1] = (0==thisYear%4 && (thisYear%100!=0 || thisYear%400==0)) ? 29 : 28; //闰年二月为29天
					//页面初始化
					$.ajaxSetup({
						contentType: 'application/json',
						async: false,
						error: function() {
							//alert(errMsg1);
							var unique_id = $.gritter.add({
								title: '系统登录错误提示',
								text: ''+errMsg1+'<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
								sticky: true,
								time: '',
								class_name: 'gritter-info gritter-center'
							});
						},
						timeout: timeout
					});
					var YY = thisYear;
					var MM = (thisMonth<10?'0':'') + thisMonth;
					var DD = (thisDay<10?'0':'') + thisDay;
					// var YY = "2014";
					// var MM = "07";
					// var DD = "04";
					var EachTime =  YY + MM + DD;
					//alert(EachTime);

					//检查考勤填报时间
					var AttendanceTime = TimeFall(YY,MM,DD,EachTime);
					var TimeData = JSON.parse(localStorage["TimeData"]);
					localStorage.AtdTime = AttendanceTime;		//缓存返回月度考勤时间

					//页面标题显示时间
					$("#EachYear").html(AttendanceTime.substring(0,4));
					$("#EachMonth").html(AttendanceTime.substring(4,6));
					$("#NextMonthBox").html('<span class="fc-button fc-button-next" style="float:left;background:#ccc;" onclick=""><span class="fc-icon fc-icon-right-single-arrow"></span></span>');
					Constant = $("#EachMonth").html();
					localStorage.Constant = Constant;

					//获取每个月天数
					var DayNum = AttendanceTime.substring(4,6) - 1;//MonthDay();入参月份减一
					MonthDay(DayNum);
					//所需填报人员的月度考勤表数据请求

					var AStateJson = APersData(AttendanceTime,localStorage.pernrBase?localStorage.pernrBase:'');
					//加载所需填报人员的月度考勤表
					if( AStateJson.ES_PUBLIC.TYPE == '0' ){
						var RunAForm = AState(AStateJson);
						if( TimeData == 0 ){						//填报时间内
							if( RunAForm == "4" ){
								$("#DayEach").children("tbody").html("");
								$("#ASubmitBtn").addClass("disabled");
								$("#ASubmitBtn").addClass("hide");
							}else{
								if( RunAForm == "2" ){
									$("#ASubmitBtn").addClass("disabled");
									$("#ASubmitBtn").addClass("hide");
								}else{
									$("#ASubmitBtn").removeClass("disabled");
									$("#ASubmitBtn").removeClass("hide");
								}
								var PAtD_item = AStateJson.TIMESHEET.item;
								localStorage.removeItem("PAtD_item");
								localStorage.PAtD_item = JSON.stringify(PAtD_item);
								localStorage.removeItem("PAtD_item_Submit");
								localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item);
								localStorage.removeItem("RunAForm");
								localStorage.RunAForm = RunAForm;
								localStorage.DayNum = DayNum;
								WebJoining(PAtD_item,DayNum,RunAForm,TimeData);
							}
						}else{										//填报时间外
							if( RunAForm == "4" ){
								$("#DayEach").children("tbody").html("");
								$("#ASubmitBtn").addClass("disabled");
								$("#ASubmitBtn").addClass("hide");
							}else{
								if( RunAForm == "3" ){
									$("#ASubmitBtn").removeClass("disabled");
									$("#ASubmitBtn").removeClass("hide");
								}else{
									$("#ASubmitBtn").addClass("disabled");
									$("#ASubmitBtn").addClass("hide");
								}
								var PAtD_item = AStateJson.TIMESHEET.item;
								localStorage.removeItem("PAtD_item");
								localStorage.PAtD_item = JSON.stringify(PAtD_item);
								localStorage.removeItem("PAtD_item_Submit");
								localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item);
								localStorage.removeItem("RunAForm");
								localStorage.RunAForm = RunAForm;
								localStorage.DayNum = DayNum;
								WebJoining(PAtD_item,DayNum,RunAForm,TimeData);
							}
						}
					}else{
						var unique_id = $.gritter.add({
							title: '销售人员月度考勤初始化错误',
							text: ''+AStateJson.ES_PUBLIC.MESSAGE+'<p style="padding-top:14px;"><span class="col-sm-6"></span><span class="col-sm-6" style="text-align:right;"><button class="btn btn-xs btn-success" onclick="CloseGritter(this);WindowClose();"><i class="ace-icon fa fa-check"></i>确定</button></span></p>',
							sticky: true,
							time: '',
							class_name: 'gritter-info gritter-center'
						});
					}
					//加载所需填报人员的月度考勤表
						
					// if( RunAForm == "4" ){
					// 	$("#DayEach").children("tbody").html("");
					// 	$("#ASubmitBtn").addClass("disabled");
					// 	$("#ASubmitBtn").addClass("hide");
					// }else{
					// 	if( RunAForm == "2" ){
					// 		$("#ASubmitBtn").addClass("disabled");
					// 		$("#ASubmitBtn").addClass("hide");
					// 	}else{
					// 		$("#ASubmitBtn").removeClass("disabled");
					// 		$("#ASubmitBtn").removeClass("hide");
					// 	}
					// 	var PAtD_item = AStateJson.TIMESHEET.item;
					// 	localStorage.removeItem("PAtD_item");
					// 	localStorage.PAtD_item = JSON.stringify(PAtD_item);
					// 	localStorage.removeItem("PAtD_item_Submit");
					// 	localStorage.PAtD_item_Submit = JSON.stringify(PAtD_item);
					// 	localStorage.removeItem("RunAForm");
					// 	localStorage.RunAForm = RunAForm;
					// 	localStorage.DayNum = DayNum;
					// 	WebJoining(PAtD_item,DayNum,RunAForm);
					// }
					spinner.spin();
					layer.close(pagei);
				}, 300 + parseInt(Math.random() * 300));
   	 		})
		</script>
	</body>
</html>
